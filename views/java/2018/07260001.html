<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>重构整理二(项目规范) | Black House</title>
    <meta name="description" content="代码千万行, 注释第一行, 编码不规范, 同事两行泪.">
    <link rel="icon" href="/favicon.ico">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.35477964.css" as="style"><link rel="preload" href="/assets/js/app.23d4d300.js" as="script"><link rel="preload" href="/assets/js/4.28fd9624.js" as="script"><link rel="preload" href="/assets/js/1.928d15b1.js" as="script"><link rel="preload" href="/assets/js/59.3b16a882.js" as="script"><link rel="prefetch" href="/assets/js/10.c2349238.js"><link rel="prefetch" href="/assets/js/100.031b764c.js"><link rel="prefetch" href="/assets/js/11.597103f4.js"><link rel="prefetch" href="/assets/js/12.01e326a5.js"><link rel="prefetch" href="/assets/js/13.6937eabc.js"><link rel="prefetch" href="/assets/js/14.0e95ab13.js"><link rel="prefetch" href="/assets/js/15.43c0e778.js"><link rel="prefetch" href="/assets/js/16.8c75ae64.js"><link rel="prefetch" href="/assets/js/17.02d12878.js"><link rel="prefetch" href="/assets/js/18.6b597676.js"><link rel="prefetch" href="/assets/js/19.524d893b.js"><link rel="prefetch" href="/assets/js/20.11686f52.js"><link rel="prefetch" href="/assets/js/21.ad025f0d.js"><link rel="prefetch" href="/assets/js/22.dca96777.js"><link rel="prefetch" href="/assets/js/23.121a28ab.js"><link rel="prefetch" href="/assets/js/24.99537c05.js"><link rel="prefetch" href="/assets/js/25.8f31fa14.js"><link rel="prefetch" href="/assets/js/26.a121c6cc.js"><link rel="prefetch" href="/assets/js/27.a57ec579.js"><link rel="prefetch" href="/assets/js/28.3f009b45.js"><link rel="prefetch" href="/assets/js/29.9c269e5b.js"><link rel="prefetch" href="/assets/js/30.168f09f3.js"><link rel="prefetch" href="/assets/js/31.ed454542.js"><link rel="prefetch" href="/assets/js/32.5f77ac76.js"><link rel="prefetch" href="/assets/js/33.3b921274.js"><link rel="prefetch" href="/assets/js/34.2e2dd8bc.js"><link rel="prefetch" href="/assets/js/35.457382a4.js"><link rel="prefetch" href="/assets/js/36.097474f8.js"><link rel="prefetch" href="/assets/js/37.2914dab3.js"><link rel="prefetch" href="/assets/js/38.bd900eff.js"><link rel="prefetch" href="/assets/js/39.00b0bb76.js"><link rel="prefetch" href="/assets/js/40.6d5aae82.js"><link rel="prefetch" href="/assets/js/41.e00929aa.js"><link rel="prefetch" href="/assets/js/42.b0c12805.js"><link rel="prefetch" href="/assets/js/43.7a60ce77.js"><link rel="prefetch" href="/assets/js/44.adf74ab9.js"><link rel="prefetch" href="/assets/js/45.36b6b8e2.js"><link rel="prefetch" href="/assets/js/46.a254f56a.js"><link rel="prefetch" href="/assets/js/47.aec9ad68.js"><link rel="prefetch" href="/assets/js/48.e3477ba7.js"><link rel="prefetch" href="/assets/js/49.5d974cde.js"><link rel="prefetch" href="/assets/js/5.c7e63593.js"><link rel="prefetch" href="/assets/js/50.c71471a2.js"><link rel="prefetch" href="/assets/js/51.de15920e.js"><link rel="prefetch" href="/assets/js/52.1eabf9c1.js"><link rel="prefetch" href="/assets/js/53.ada4082c.js"><link rel="prefetch" href="/assets/js/54.985c146e.js"><link rel="prefetch" href="/assets/js/55.33da5078.js"><link rel="prefetch" href="/assets/js/56.8b899006.js"><link rel="prefetch" href="/assets/js/57.f7ea6441.js"><link rel="prefetch" href="/assets/js/58.55ca22b7.js"><link rel="prefetch" href="/assets/js/6.8843ac12.js"><link rel="prefetch" href="/assets/js/60.7365ec6c.js"><link rel="prefetch" href="/assets/js/61.0508510a.js"><link rel="prefetch" href="/assets/js/62.8c3a0bf0.js"><link rel="prefetch" href="/assets/js/63.99503945.js"><link rel="prefetch" href="/assets/js/64.1193b17d.js"><link rel="prefetch" href="/assets/js/65.40a7b476.js"><link rel="prefetch" href="/assets/js/66.c95c74fb.js"><link rel="prefetch" href="/assets/js/67.dcc1ce00.js"><link rel="prefetch" href="/assets/js/68.e8aeba6d.js"><link rel="prefetch" href="/assets/js/69.13b69234.js"><link rel="prefetch" href="/assets/js/7.cda98f34.js"><link rel="prefetch" href="/assets/js/70.2308210c.js"><link rel="prefetch" href="/assets/js/71.bdac7c88.js"><link rel="prefetch" href="/assets/js/72.d5e7dabc.js"><link rel="prefetch" href="/assets/js/73.f1cec72d.js"><link rel="prefetch" href="/assets/js/74.13cbda62.js"><link rel="prefetch" href="/assets/js/75.5ec77696.js"><link rel="prefetch" href="/assets/js/76.e80c98fb.js"><link rel="prefetch" href="/assets/js/77.edf10bf3.js"><link rel="prefetch" href="/assets/js/78.9472aec2.js"><link rel="prefetch" href="/assets/js/79.2f59f6d2.js"><link rel="prefetch" href="/assets/js/8.64e66a3d.js"><link rel="prefetch" href="/assets/js/80.9d9b311d.js"><link rel="prefetch" href="/assets/js/81.112c831f.js"><link rel="prefetch" href="/assets/js/82.e98222ae.js"><link rel="prefetch" href="/assets/js/83.a7741563.js"><link rel="prefetch" href="/assets/js/84.47f9ec86.js"><link rel="prefetch" href="/assets/js/85.4b288089.js"><link rel="prefetch" href="/assets/js/86.d01d1b2a.js"><link rel="prefetch" href="/assets/js/87.26f71539.js"><link rel="prefetch" href="/assets/js/88.0cdca4ad.js"><link rel="prefetch" href="/assets/js/89.fca9f86b.js"><link rel="prefetch" href="/assets/js/9.8fcc4a9b.js"><link rel="prefetch" href="/assets/js/90.49e1e9ad.js"><link rel="prefetch" href="/assets/js/91.58ec2d07.js"><link rel="prefetch" href="/assets/js/92.0da2a72c.js"><link rel="prefetch" href="/assets/js/93.9d312aaf.js"><link rel="prefetch" href="/assets/js/94.e94db684.js"><link rel="prefetch" href="/assets/js/95.ed2aa34a.js"><link rel="prefetch" href="/assets/js/96.6a2e264d.js"><link rel="prefetch" href="/assets/js/97.8a055f18.js"><link rel="prefetch" href="/assets/js/98.1284385e.js"><link rel="prefetch" href="/assets/js/99.830ddc7a.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.3ceaf8af.js">
    <link rel="stylesheet" href="/assets/css/0.styles.35477964.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="theme-container"><div><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/head.png" alt="Black House" class="logo"> <span class="site-name">Black House</span></a> <div class="links"><div class="color-picker"><a href="#" class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><!----> <div class="dark-theme-options toggle-option"><label for="dark-theme-toggle">Enable Dark Theme?</label> <input id="dark-theme-toggle" type="checkbox" checked="checked"></div></div></div></div> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/category/Design.html" class="nav-link"><i class="iconfont undefined"></i>
  Design
</a></li><li class="dropdown-item"><!----> <a href="/category/Framework.html" class="nav-link"><i class="iconfont undefined"></i>
  Framework
</a></li><li class="dropdown-item"><!----> <a href="/category/Spring.html" class="nav-link"><i class="iconfont undefined"></i>
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/category/Issue.html" class="nav-link"><i class="iconfont undefined"></i>
  Issue
</a></li><li class="dropdown-item"><!----> <a href="/category/Java.html" class="nav-link"><i class="iconfont undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/category/Mac.html" class="nav-link"><i class="iconfont undefined"></i>
  Mac
</a></li><li class="dropdown-item"><!----> <a href="/category/Other.html" class="nav-link"><i class="iconfont undefined"></i>
  Other
</a></li><li class="dropdown-item"><!----> <a href="/category/Middleware.html" class="nav-link"><i class="iconfont undefined"></i>
  Middleware
</a></li><li class="dropdown-item"><!----> <a href="/category/NoSQL.html" class="nav-link"><i class="iconfont undefined"></i>
  NoSQL
</a></li><li class="dropdown-item"><!----> <a href="/category/Python.html" class="nav-link"><i class="iconfont undefined"></i>
  Python
</a></li><li class="dropdown-item"><!----> <a href="/category/Tools.html" class="nav-link"><i class="iconfont undefined"></i>
  Tools
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeLine/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/dong4j" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/category/Design.html" class="nav-link"><i class="iconfont undefined"></i>
  Design
</a></li><li class="dropdown-item"><!----> <a href="/category/Framework.html" class="nav-link"><i class="iconfont undefined"></i>
  Framework
</a></li><li class="dropdown-item"><!----> <a href="/category/Spring.html" class="nav-link"><i class="iconfont undefined"></i>
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/category/Issue.html" class="nav-link"><i class="iconfont undefined"></i>
  Issue
</a></li><li class="dropdown-item"><!----> <a href="/category/Java.html" class="nav-link"><i class="iconfont undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/category/Mac.html" class="nav-link"><i class="iconfont undefined"></i>
  Mac
</a></li><li class="dropdown-item"><!----> <a href="/category/Other.html" class="nav-link"><i class="iconfont undefined"></i>
  Other
</a></li><li class="dropdown-item"><!----> <a href="/category/Middleware.html" class="nav-link"><i class="iconfont undefined"></i>
  Middleware
</a></li><li class="dropdown-item"><!----> <a href="/category/NoSQL.html" class="nav-link"><i class="iconfont undefined"></i>
  NoSQL
</a></li><li class="dropdown-item"><!----> <a href="/category/Python.html" class="nav-link"><i class="iconfont undefined"></i>
  Python
</a></li><li class="dropdown-item"><!----> <a href="/category/Tools.html" class="nav-link"><i class="iconfont undefined"></i>
  Tools
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeLine/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/dong4j" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>重构整理二(项目规范)</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/views/java/2018/07260001.html#废话" class="sidebar-link">废话</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/java/2018/07260001.html#let-s-go" class="sidebar-link">Let's go</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/java/2018/07260001.html#开篇" class="sidebar-link">开篇</a></li><li class="sidebar-sub-header"><a href="/views/java/2018/07260001.html#这个才是开篇" class="sidebar-link">这个才是开篇</a></li></ul></li><li><a href="/views/java/2018/07260001.html#约定" class="sidebar-link">约定</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/java/2018/07260001.html#准备工作" class="sidebar-link">准备工作</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/java/2018/07260001.html#intellij-idea-插件" class="sidebar-link">Intellij IDEA 插件</a></li><li class="sidebar-sub-header"><a href="/views/java/2018/07260001.html#intellij-idea-设置" class="sidebar-link">Intellij IDEA 设置</a></li><li class="sidebar-sub-header"><a href="/views/java/2018/07260001.html#version-control-设置" class="sidebar-link">Version Control 设置</a></li></ul></li><li><a href="/views/java/2018/07260001.html#代码样式" class="sidebar-link">代码样式</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/java/2018/07260001.html#musicsearch-project-规范" class="sidebar-link">musicsearch-project 规范</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/java/2018/07260001.html#项目结构规范" class="sidebar-link">项目结构规范</a></li><li class="sidebar-sub-header"><a href="/views/java/2018/07260001.html#模块名" class="sidebar-link">模块名</a></li><li class="sidebar-sub-header"><a href="/views/java/2018/07260001.html#包名" class="sidebar-link">包名</a></li><li class="sidebar-sub-header"><a href="/views/java/2018/07260001.html#类名" class="sidebar-link">类名</a></li><li class="sidebar-sub-header"><a href="/views/java/2018/07260001.html#方法名" class="sidebar-link">方法名</a></li><li class="sidebar-sub-header"><a href="/views/java/2018/07260001.html#属性名" class="sidebar-link">属性名</a></li></ul></li><li><a href="/views/java/2018/07260001.html#数据库规范" class="sidebar-link">数据库规范</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/java/2018/07260001.html#配置规范" class="sidebar-link">配置规范</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/java/2018/07260001.html#配置分类" class="sidebar-link">配置分类</a></li><li class="sidebar-sub-header"><a href="/views/java/2018/07260001.html#local-环境" class="sidebar-link">local 环境</a></li><li class="sidebar-sub-header"><a href="/views/java/2018/07260001.html#dev-环境" class="sidebar-link">dev 环境</a></li><li class="sidebar-sub-header"><a href="/views/java/2018/07260001.html#test-环境" class="sidebar-link">test 环境</a></li><li class="sidebar-sub-header"><a href="/views/java/2018/07260001.html#prod-环境" class="sidebar-link">prod 环境</a></li><li class="sidebar-sub-header"><a href="/views/java/2018/07260001.html#dubbo-配置文件" class="sidebar-link">Dubbo 配置文件</a></li><li class="sidebar-sub-header"><a href="/views/java/2018/07260001.html#spring-配置文件" class="sidebar-link">Spring 配置文件</a></li></ul></li><li><a href="/views/java/2018/07260001.html#maven" class="sidebar-link">Maven</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/java/2018/07260001.html#pom-规范" class="sidebar-link">pom 规范</a></li></ul></li><li><a href="/views/java/2018/07260001.html#日志规范" class="sidebar-link">日志规范</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/java/2018/07260001.html#日志配置名" class="sidebar-link">日志配置名</a></li><li class="sidebar-sub-header"><a href="/views/java/2018/07260001.html#输出样式" class="sidebar-link">输出样式</a></li><li class="sidebar-sub-header"><a href="/views/java/2018/07260001.html#日志保存路径" class="sidebar-link">日志保存路径</a></li><li class="sidebar-sub-header"><a href="/views/java/2018/07260001.html#日志归档" class="sidebar-link">日志归档</a></li></ul></li><li><a href="/views/java/2018/07260001.html#单元测试规范" class="sidebar-link">单元测试规范</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <div><main class="page reco-hide"> <div class="page-title"><h1>重构整理二(项目规范)</h1> <hr> <div data-v-0b496ca7><i class="iconfont reco-account" data-v-0b496ca7><span data-v-0b496ca7>dong4j</span></i> <i class="iconfont reco-date" data-v-0b496ca7><span data-v-0b496ca7>7/9/2018</span></i> <!----> <i class="iconfont reco-tag tags" data-v-0b496ca7><span class="tag-item" data-v-0b496ca7>
      Other
    </span></i></div></div> <div class="content__default"><div class="tip custom-block"><p>项目重构整理</p></div> <h2 id="废话"><a href="#废话" aria-hidden="true" class="header-anchor">#</a> 废话</h2> <p>此篇是 12530 架构重构第二篇, 以 <a href="https://github.com/alibaba/p3c/" target="_blank" rel="noopener noreferrer">阿里巴巴开发手册<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 为基础, 结合自己工作经验, 作为 <code>musicsearch-project</code> 重构方案的基础部分.
以此为约束, 希望构建一个<code>稳定</code>, <code>易于维护</code>, <code>可扩展</code> 的重构方案.</p> <p>一个项目最怕多种编码风格, 实体名一会 entity, 一会 model, 让维护的人身心疲惫, 因此在一个项目中保持唯一一种编码习惯, 有利于代码维护(比如通过命名, 就知道作用以及所在的包名).</p> <p><strong>见名知意, 此乃命名的最高境界(体会一下 <code>取名10分钟, 编码1分钟</code> 的境界 😂).</strong></p> <blockquote><p>代码规范看起来比较枯燥, 看完一遍可能只有一点点印象, 因此我采用比较逗比的方式, 尽量让大家一遍就记住.
代码规范比较偏向个人主义, 每个人的编码习惯都不一样, 所以希望多提出自己的建议, 一起改进(没有最好的规范, 只有最合适的. 🙃)</p></blockquote> <h2 id="let-s-go"><a href="#let-s-go" aria-hidden="true" class="header-anchor">#</a> Let's go</h2> <h3 id="开篇"><a href="#开篇" aria-hidden="true" class="header-anchor">#</a> 开篇</h3> <p>话说盘古开天辟地之时... 亚当和夏娃诞生混沌之间, 他们从小青梅竹马, 一个会唱 200 首歌, 一个会跳 200 支舞, 后人称他们一个为 二百歌, 一个为 二百舞 ..... (用心去体会😂)</p> <h3 id="这个才是开篇"><a href="#这个才是开篇" aria-hidden="true" class="header-anchor">#</a> 这个才是开篇</h3> <p>江湖四分五裂, 一人一江湖...</p> <p>但我们是一个团队, 为了便于管理和维护, 急需一份代码规范, 来约束我们的编码规则和习惯, 就像修炼一门武林绝学, 需要秘籍的指引(葵花宝典?).</p> <p>请各位英雄好汉仔细阅读 严格遵守
如有不足之处 希望提出意见 共商武林统一霸业</p> <p>从 1000 个哈姆雷特转变为同一个 <strong>林志玲</strong>, 代码风格保持统一有利于提高工作效率, 便于管理.</p> <p>比如:</p> <ol><li>一看到以 Controller 结尾的类, 就应该知道这个是接口, 用于参数验证, 调用业务类进行处理业务逻辑, 组装结果, 返回数据或者跳转页面;</li> <li>一看到以 Service 结尾的类, 就知道这个是业务接口类, 用于定义业务接口;</li> <li>一看到以 Impl 结尾的类, 就应该知道这个是业务实现类, 组合不同的 Dao, 实现业务逻辑;</li> <li>一看到以 Dao 结尾的类, 就应该知道这个是 DB 操作类, 对数据进行 CRUD 操作;</li> <li>一看到以 Dto 结尾的类, 就应该知道这个是数据传输对象, 用于展示层和服务层之间的数据传输;</li> <li>....</li></ol> <h2 id="约定"><a href="#约定" aria-hidden="true" class="header-anchor">#</a> 约定</h2> <p>为了避免歧义, 文档大量使用以下词汇, 解释如下:</p> <ol><li><code>必须</code> (must): 绝对, 严格遵循, 请照做, 无条件遵守；</li> <li><code>一定不可</code> (must not): 禁令, 严令禁止；</li> <li><code>应该</code> (should): 强烈建议这样做, 但是不强求；</li> <li><code>不该</code> (should not): 强烈不建议这样做, 但是不强求；</li> <li><code>可以</code> (may) 和 可选 (optional): 选择性高一点, 在这个文档内, 此词语使用较少；</li> <li><code>推荐</code> (recommend): 个人推荐的做法, 不强求;</li></ol> <h2 id="准备工作"><a href="#准备工作" aria-hidden="true" class="header-anchor">#</a> 准备工作</h2> <blockquote><p>行走江湖, 没有一件趁手的兵器怎么能在江湖中立足, 还在用 <code>eclipse</code> 的少侠们, 希望弃暗投明, 拥抱 Intellij IDEA, 你会发现编码效率提升不是<strong>点巴点儿</strong>, 而是<strong>蹭蹭蹭</strong>的往上涨 😁.</p></blockquote> <p><strong>我不是富二代, 我没有赢在人生的起跑线上, 但是我用 Intellij IDEA, 我赢在了工作的起跑线上!</strong></p> <p>推荐一个比较全面的 <a href="https://github.com/judasn/IntelliJ-IDEA-Tutorial" target="_blank" rel="noopener noreferrer">Intellij IDEA 教程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><strong>工欲善其事, 必先利其器. 一件趁手的兵器带你迎娶白富美, 走上人生巅峰, 统一江湖, 指日可待</strong></p> <p><img src="http://qiniu.dong4j.info/2019-07-03-E5B0DCDC-184E-4B43-9445-4D37AB01FCB8.png" alt="E5B0DCDC-184E-4B43-9445-4D37AB01FCB8"></p> <p>为了简化手动操作和提高编码效率, 要求安装几个必要的插件, 以及对 IDEA 进行必要的优化配置</p> <h3 id="intellij-idea-插件"><a href="#intellij-idea-插件" aria-hidden="true" class="header-anchor">#</a> Intellij IDEA 插件</h3> <h4 id="alibaba-java-coding-guidelines"><a href="#alibaba-java-coding-guidelines" aria-hidden="true" class="header-anchor">#</a> Alibaba Java Coding Guidelines</h4> <blockquote><p><code>必须</code> 安装, 代码规范检查的基础</p></blockquote> <p><strong>作用: 代码规则检查</strong></p> <p>此插件是 阿里巴巴根据 <a href="https://github.com/alibaba/p3c/" target="_blank" rel="noopener noreferrer">阿里巴巴开发手册<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 开发的一个静态代码规范检查插件, 每个警告都提供了一个 demo,</p> <p><img src="http://qiniu.dong4j.info/2019-07-03-15328795139039.jpg" alt="-w1184">
此篇以 <a href="https://github.com/alibaba/p3c/" target="_blank" rel="noopener noreferrer">阿里巴巴开发手册<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 为基础, 但是并不会一一罗列每条规范, 因为此插件已经能很好的检查了.</p> <p><strong>此篇重点在于这个插件不能检查的规范.</strong></p> <h4 id="lombok"><a href="#lombok" aria-hidden="true" class="header-anchor">#</a> lombok</h4> <blockquote><p><code>必须</code> 安装, 不然代码跑不起来就尴尬了</p></blockquote> <p><strong>作用: 化繁为简. <a href="%5Bhttp://projectlombok.org/%5D(http://projectlombok.org/)">官网</a></strong></p> <p>使用 <code>@Data</code> 代替烦人的 get/set 方法</p> <p><img src="http://qiniu.dong4j.info/2019-07-03-15328790004411.jpg" alt="-w985"></p> <p>使用 <code>@Slf4j</code> 代替获取 log 实例的代码</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">ApplicationTest</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="http://qiniu.dong4j.info/2019-07-03-15328779809729.jpg" alt="-w587"></p> <p><strong>使用方式</strong>:</p> <ol><li>在pom文件中添加:</li></ol> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- lombok--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${lombok.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="2"><li>在 IDEA 中添加插件 <code>lombok</code> （file-&gt;setting-&gt;plugins）</li> <li>IDEA 设置</li></ol> <p><img src="http://qiniu.dong4j.info/2019-07-03-15328775278509.jpg" alt="-w1170"></p> <h4 id="maven-helper"><a href="#maven-helper" aria-hidden="true" class="header-anchor">#</a> Maven Helper</h4> <blockquote><p><code>必须</code> 安装, 不然依赖冲突了就不好了</p></blockquote> <p><strong>作用: 检查依赖冲突</strong></p> <p>新加入一个 jar 包, 谁添加谁负责, 使用此插件检查是否有依赖冲突.</p> <p>依赖冲突可能会导致:</p> <ol><li>java.lang.ClassNotFoundException</li> <li>java.lang.NoSuchMethodError</li> <li>java.lang.NoClassDefFoundError</li> <li>开发环境正常, 测试或者生产环境不正常....</li></ol> <p><img src="http://qiniu.dong4j.info/2019-07-03-15328788693057.jpg" alt="-w900"></p> <h4 id="javadoc"><a href="#javadoc" aria-hidden="true" class="header-anchor">#</a> JavaDoc</h4> <blockquote><p><code>必须</code> 安装</p></blockquote> <p><strong>作用: 快速生成标准的 javadoc</strong></p> <p><img src="http://qiniu.dong4j.info/2019-07-03-2018-07-30%2014.28.41.gif" alt="2018-07-30 14.28.41"></p> <h4 id="jrebel"><a href="#jrebel" aria-hidden="true" class="header-anchor">#</a> JRebel</h4> <blockquote><p><code>推荐</code> 安装, 提高工作效率的插件.</p></blockquote> <p><strong>作用: 代码热部署插件, 改了代码后, 重新编译, 不用重启应用就可查看效果.</strong></p> <p>热部署插件, 谁用谁知道;</p> <p><a href="http://blog.lanyus.com/search/JRebel/" target="_blank" rel="noopener noreferrer">科学使用方法<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> (低调点)</p> <h4 id="mybatis-plugin"><a href="#mybatis-plugin" aria-hidden="true" class="header-anchor">#</a> Mybatis Plugin</h4> <blockquote><p><code>推荐</code> 安装, 提高工作效率的插件.</p></blockquote> <p><strong>作用: xml 和 dao 快速跳转; 快速生成 xml; xml 检查</strong></p> <p><img src="http://qiniu.dong4j.info/2019-07-03-2018-07-30%2010.25.12.gif" alt="2018-07-30 10.25.12"></p> <h4 id="generateserialversionuid"><a href="#generateserialversionuid" aria-hidden="true" class="header-anchor">#</a> GenerateSerialVersionUID</h4> <blockquote><p><code>推荐</code> 安装, 提高工作效率的插件</p></blockquote> <p><strong>作用: 为实现了 Serializable 接口的实体快速添加 serialVersionUID, 提高效率</strong></p> <p>因为要求实体 <code>必须</code> 实现 <code>Serializable</code> 接口, 而且<code>必须</code> 添加 <code>serialVersionUID</code> 字段.</p> <p><img src="http://qiniu.dong4j.info/2019-07-03-2018-07-29%2023.48.26.gif" alt="2018-07-29 23.48.26"></p> <h4 id="generateallsetter"><a href="#generateallsetter" aria-hidden="true" class="header-anchor">#</a> GenerateAllSetter</h4> <blockquote><p><code>推荐</code> 安装, 提高工作效率的插件</p></blockquote> <p><strong>作用: 快速生成 set 方法</strong></p> <p><img src="http://qiniu.dong4j.info/2019-07-03-2018-07-29%2023.59.07.gif" alt="2018-07-29 23.59.07"></p> <h4 id="translation"><a href="#translation" aria-hidden="true" class="header-anchor">#</a> Translation</h4> <blockquote><p><code>推荐</code> 安装, 提高工作效率的插件</p></blockquote> <p><strong>作用: 翻译插件, 提供 百度, 有道, Google 翻译</strong></p> <p>一款为像我这种英语渣的码农量身定做的插件 😂</p> <p><img src="http://qiniu.dong4j.info/2019-07-03-2018-07-30%2000.05.57.gif" alt="2018-07-30 00.05.57"></p> <h4 id="grep-console"><a href="#grep-console" aria-hidden="true" class="header-anchor">#</a> Grep Console</h4> <blockquote><p><code>推荐</code> 安装</p></blockquote> <p><strong>作用: 高亮显示 log 不同级别日志, 看日志的时候一目了然; 具有 error 级别声音提醒功能(可设置)</strong></p> <p>效果:</p> <p><img src="http://qiniu.dong4j.info/2019-07-03-15328811376957.jpg" alt="-w1274"></p> <p>插件设置:</p> <p><img src="http://qiniu.dong4j.info/2019-07-03-15328811964699.jpg" alt="-w1189">
此插件通过 log 输出中的 info/debug/warn/error 来匹配对应的颜色. 因此 log 输出中必须包含 <strong>日志级别</strong>, 这个 <strong>日志规范</strong> 中再说.</p> <h4 id="restfultoolkit"><a href="#restfultoolkit" aria-hidden="true" class="header-anchor">#</a> RestfulToolkit</h4> <blockquote><p><code>推荐</code> 安装</p></blockquote> <p><strong>作用: 快速定位接口, Rest 请求模拟</strong></p> <p><img src="http://qiniu.dong4j.info/2019-07-03-2018-07-30%2010.32.58.gif" alt="2018-07-30 10.32.58"></p> <h4 id="restore-sql-for-ibatis-mybatis"><a href="#restore-sql-for-ibatis-mybatis" aria-hidden="true" class="header-anchor">#</a> Restore Sql for iBatis/Mybatis</h4> <blockquote><p><code>推荐</code> 安装</p></blockquote> <p><strong>作用: 查看请求 sql, 可直接运行</strong></p> <p>效果:</p> <p><code>meeting-service</code> 调用 <code>/login</code> 接口后需要执行的 sql</p> <p><img src="http://qiniu.dong4j.info/2019-07-03-15329308524148.jpg" alt="-w999"></p> <h3 id="intellij-idea-设置"><a href="#intellij-idea-设置" aria-hidden="true" class="header-anchor">#</a> Intellij IDEA 设置</h3> <h4 id="编码设置"><a href="#编码设置" aria-hidden="true" class="header-anchor">#</a> 编码设置</h4> <blockquote><p>编码 <code>必须</code> 使用 <code>UTF-8</code>, 且 <code>必须</code> 设置为 <code>with NO BOM</code></p></blockquote> <p><img src="http://qiniu.dong4j.info/2019-07-03-15329216121953.jpg" alt="-w1036"></p> <p><code>踩坑</code></p> <p><strong>Windows 下请不要用记事本打开 UFT-8 编码的文本文件, 更不要保存</strong></p> <p>Windows 坑的很, UTF-8 编码的文本文件最前面会给你加上一个 BOM, 其他系统打开是正常显示, 但是不会显示这个 BOM, 造成文件解析出错.</p> <h5 id="html-设置编码为-utf-8"><a href="#html-设置编码为-utf-8" aria-hidden="true" class="header-anchor">#</a> html 设置编码为 UTF-8</h5> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>html 或者模板 <code>应该</code> 使用 html5</p></blockquote> <p>html4 升级为 html5 非常简单</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Content-Type<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text/html;charset=UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text/css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>css.css<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>jquery.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>修改为:</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>css.css<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>jquery.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>简单的升级, 就能享受 30 多个新标签带来的便捷, 何乐而不为呢?</p> <p>就跟超市打折一样, 还倒送你30块, 跳广场舞的大妈排着队去, 你还不去?</p> <h5 id="tomcat-设置编码为-utf-8"><a href="#tomcat-设置编码为-utf-8" aria-hidden="true" class="header-anchor">#</a> Tomcat 设置编码为 UTF-8</h5> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Connector</span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>8080<span class="token punctuation">&quot;</span></span> <span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>HTTP/1.1<span class="token punctuation">&quot;</span></span> 
                <span class="token attr-name">connectionTimeout</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>20000<span class="token punctuation">&quot;</span></span> 
                <span class="token attr-name">redirectPort</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>8443<span class="token punctuation">&quot;</span></span>  <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>改为:</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Connector</span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>8080<span class="token punctuation">&quot;</span></span> <span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>HTTP/1.1<span class="token punctuation">&quot;</span></span> 
                <span class="token attr-name">connectionTimeout</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>20000<span class="token punctuation">&quot;</span></span> 
                <span class="token attr-name">redirectPort</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>8443<span class="token punctuation">&quot;</span></span> 
                <span class="token attr-name">URIEncoding</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Tomcat7 默认编码为 ISO-8859-1, 到了 Tomcat8 后, 默认编码改为 UTF-8
因此以上修改只针对于 Tomcat7.</p> <h4 id="todo-标识"><a href="#todo-标识" aria-hidden="true" class="header-anchor">#</a> todo 标识</h4> <blockquote><p><code>必须</code></p></blockquote> <p><strong>作用: 方便搜索, 明确负责人, 说明 todo 原因</strong></p> <p>这里扩展了 IDEA 自带的 todo 标识, 使用 <code>todo-负责人: (时间) [原因]</code> 来规范 <code>todo</code> 用法</p> <p><img src="http://qiniu.dong4j.info/2019-07-03-15329324780441.jpg" alt="-w1172"></p> <div class="language-lua line-numbers-mode"><pre class="language-lua"><code>todo<span class="token operator">-</span>负责人<span class="token punctuation">:</span> <span class="token punctuation">(</span>$date$ $time$<span class="token punctuation">)</span> <span class="token punctuation">[</span>$SELECTION$<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>date time 设置见 类注释一节</strong></p> <p>效果:</p> <p><img src="http://qiniu.dong4j.info/2019-07-03-2018-07-30%2014.35.26.gif" alt="2018-07-30 14.35.26"></p> <h4 id="fixme-标识"><a href="#fixme-标识" aria-hidden="true" class="header-anchor">#</a> fixme 标识</h4> <blockquote><p><code>必须</code></p></blockquote> <div class="language-lua line-numbers-mode"><pre class="language-lua"><code>fixme<span class="token operator">-</span>负责人<span class="token punctuation">:</span> <span class="token punctuation">(</span>$date$ $time$ <span class="token punctuation">[</span>$SELECTION$<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>设置和效果同上</p> <h4 id="类注释"><a href="#类注释" aria-hidden="true" class="header-anchor">#</a> 类注释</h4> <blockquote><p><code>必须</code> 为每个类添加必要的注释</p></blockquote> <p>这里有2中方式:</p> <p><strong>1. 新建类时添加注释</strong></p> <p><img src="http://qiniu.dong4j.info/2019-07-03-2018-07-30%2014.51.14.gif" alt="2018-07-30 14.51.14"></p> <p>设置方式:</p> <p><img src="http://qiniu.dong4j.info/2019-07-03-15329339225336.jpg" alt="-w1185"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>#<span class="token keyword">if</span> <span class="token punctuation">(</span>$<span class="token punctuation">{</span>PACKAGE_NAME<span class="token punctuation">}</span> <span class="token operator">&amp;&amp;</span> $<span class="token punctuation">{</span>PACKAGE_NAME<span class="token punctuation">}</span> <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token keyword">package</span> $<span class="token punctuation">{</span>PACKAGE_NAME<span class="token punctuation">}</span><span class="token punctuation">;</span>#end
##<span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&quot;File Header.java&quot;</span><span class="token punctuation">)</span>

<span class="token comment">/**
 * &lt;p&gt;Company: 科大讯飞股份有限公司-四川分公司&lt;/p&gt;
 * &lt;p&gt;Description: ${description}&lt;/p&gt;
 ¶*
 * @author 你的昵称
 * @date ${YEAR}-${MONTH}-${DAY} ${HOUR}:${MINUTE}
 * @email 域名@iflytek.com
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> $<span class="token punctuation">{</span>NAME<span class="token punctuation">}</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>2. 为已存在的类添加注释</strong></p> <p><img src="http://qiniu.dong4j.info/2019-07-03-2018-07-30%2014.54.17.gif" alt="2018-07-30 14.54.17"></p> <p>设置方式:</p> <p><img src="http://qiniu.dong4j.info/2019-07-03-15329341699207.jpg" alt="-w1112"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * &lt;p&gt;Company: 科大讯飞股份有限公司-四川分公司&lt;/p&gt;
 * &lt;p&gt;Description: $END$&lt;/p&gt;
 *
 * @author 你的昵称
 * @date $date$ $time$
 * @email 域名@iflytek.com
 */</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="方法注释"><a href="#方法注释" aria-hidden="true" class="header-anchor">#</a> 方法注释</h4> <blockquote><p><code>推荐</code> 使用 JavaDoc 插件自动生成</p></blockquote> <p>JavaDoc 只能自动生成非 <code>private</code> 方法和属性的注释, 如果需要生成 <code>private</code> 级的注释, 可以通过修改 <code>public</code>, 生成完成后, 再修改回来</p> <h4 id="代码注释"><a href="#代码注释" aria-hidden="true" class="header-anchor">#</a> 代码注释</h4> <blockquote><p><code>不该</code> 使用行尾注释;
<code>推荐</code> 使用 // 代替 /*...*/ 多行注释;
<code>推荐</code> 使用 /**..*/ 对字段进行注释(单行);
所有字段名, 方法名, 类名 都 <code>应该</code> 使用简单, 业界常用的单词命名, 不要为了注释而注释, 讲究个代码之美.</p></blockquote> <p>在查看大段代码时, <code>推荐</code> 使用</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// region 段注释</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment">//endregion</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>此注释能增加代码折叠功能, 便于快速梳理代码</strong></p> <p><img src="http://qiniu.dong4j.info/2019-07-03-2018-07-30%2022.44.45.gif" alt="2018-07-30 22.44.45"></p> <h3 id="version-control-设置"><a href="#version-control-设置" aria-hidden="true" class="header-anchor">#</a> Version Control 设置</h3> <blockquote><p><code>必须</code> 忽略 target 目录
<code>必须</code> 忽略 .idea
<code>必须</code> 忽略 *.iml
<code>必须</code> 添加 .ignore 文件</p></blockquote> <p><strong>如果使用 git, 所有忽略文件都可以添加到 .ignore 即可</strong></p> <p><strong>提交代码时的设置</strong></p> <p><img src="http://qiniu.dong4j.info/2019-07-03-15329625162083.jpg" alt="-w1089"></p> <blockquote><p><code>必须</code> 勾选 Optimize imports; (提交代码时, 自动删除不被使用的 import)
<code>推荐</code> 取消掉默认勾选的 Perform code analysis 和 Check TODO, 会增加提交代码的时间;
<code>不该</code> 勾选 Reformat code, 会格式化所有提交的代码, 格式化代码应该自己手动格式化, 这样能减少代码冲突的可能;</p></blockquote> <h2 id="代码样式"><a href="#代码样式" aria-hidden="true" class="header-anchor">#</a> 代码样式</h2> <p>以 intellij-java-google-style.xml 为基础, 做了一部分修改.</p> <blockquote><p>musicsearch-project <code>必须的必须</code> 使用此代码样式, 为了减少代码冲突, 同一代码样式 (同一门派, 你去修炼其他门派武功, 会被逐出师门的!).</p></blockquote> <p>比如:</p> <ol><li>一行的代码长度不能超过 140 宽;</li> <li>等号对齐;</li> <li>if 语句只有一行也 <code>必须</code> 加大括号;</li> <li>所有操作符两边 <code>必须</code> 有空格;</li> <li>类名, 方法名 <code>必须</code> 加空格后才跟 一个 <code>{</code>;</li> <li>使用 4 个空格代替制表符(我们这里不讨论空格好还是制表符好, 统一使用一种是最最好的);</li> <li>....</li></ol> <p><strong>以上列举的部分规范都可以使用格式化解决;</strong></p> <p>本人对代码有着严(变)格(态)的要求, 严(变)格(态)到使用 <code>//</code> 后面 <code>必须</code> 跟一个空格, 然后才是注释内容; 英文和中文之间 <code>必须</code> 增加一个空格; 所有标点全部使用英文标点; 没有被使用的类, 变量都 <code>必须</code> 删除; 遇到的警告 <code>必须</code> 尽最大努力改正;</p> <p>左边为重构之前的警告数量(黄色), 右边为重构之后的</p> <p><img src="http://qiniu.dong4j.info/2019-07-03-15329635760293.jpg" alt="-w1152"></p> <ol><li>英文和中文之间增加空格是为了便于阅读, 方便拷贝(双击英文即可全选, 如果不增加空格, 中文英文则会全被选中. 我变态到 chrome 都要安装一个叫 <code>空格之神</code> 的插件, 用于在中英文之间追加空格);</li> <li>全部使用英文标点的好处不言而喻, Java 乃至所有的编程语言都不支持中文标点, 打个分号还得切换输入法, 想想都忧伤; 有时候就是因为中文标点的问题, 一直报错(输入法可以设置中文时使用英文标点, <code>推荐</code> 这种设置);</li> <li>符号后面喜欢追加一个空格, 是受 Markdown 语法的影响, 以前用过很多 Markdown 编辑工具, 由于解析语法不一样, 迁移时渲染不生效, 加个空格或者换行就 Ok 了; 😂</li> <li>及时删除不需要的代码, 时刻保持代码干净(IDEA 会帮我们检查未使用的代码).</li> <li><strong>警告是 bug 的温床, 修复警告, 就是修复潜在的 bug</strong>. 修复警告, 也能学到很多东西的 (😎)</li></ol> <h2 id="musicsearch-project-规范"><a href="#musicsearch-project-规范" aria-hidden="true" class="header-anchor">#</a> musicsearch-project 规范</h2> <p>以下作为 <code>musicsearch-project</code> 规范, 制定了大部分要求.</p> <p>具体设计将在 第三篇 介绍</p> <h3 id="项目结构规范"><a href="#项目结构规范" aria-hidden="true" class="header-anchor">#</a> 项目结构规范</h3> <div class="language-lua line-numbers-mode"><pre class="language-lua"><code><span class="token punctuation">.</span>
├── musicsearch<span class="token operator">-</span>business            <span class="token operator">#</span> 业务主模块
│   ├── business<span class="token operator">-</span>common             <span class="token operator">#</span> 业务公共类库
│   ├── mservice<span class="token operator">-</span>migu<span class="token operator">-</span>game          <span class="token operator">#</span> migu<span class="token operator">-</span>game 业务
│   └── service<span class="token operator">-</span>meeting             <span class="token operator">#</span> meeting 服务模块
├── musicsearch<span class="token operator">-</span>common              <span class="token operator">#</span> musicsearch 项目 公共模块
├── musicsearch<span class="token operator">-</span>component           <span class="token operator">#</span> 组件主模块
│   ├── component<span class="token operator">-</span>iavp              <span class="token operator">#</span> iavp 模块<span class="token punctuation">,</span> 封装 iavp 相关实体和接口<span class="token punctuation">,</span> 直接注入即可
│   ├── component<span class="token operator">-</span>mybatis           <span class="token operator">#</span> mybatis模块<span class="token punctuation">,</span> 提供代码生成和 mybatis 相关功能
│   ├── component<span class="token operator">-</span>redis             <span class="token operator">#</span> redis 模块<span class="token punctuation">,</span> 注入 RedisService 即可<span class="token punctuation">,</span> 提供多种模式
│   └── component<span class="token operator">-</span>websocket         <span class="token operator">#</span> websocket 模块 netty<span class="token operator">-</span>socket<span class="token punctuation">.</span>io 封装
├── musicsearch<span class="token operator">-</span>demo                <span class="token operator">#</span> demo 主模块
│   ├── component<span class="token operator">-</span>mybatis<span class="token operator">-</span>demo
│   └── component<span class="token operator">-</span>redis<span class="token operator">-</span>demo
├── musicsearch<span class="token operator">-</span>dependencies        <span class="token operator">#</span> 管理第三方 jar 版本和依赖关系
├── musicsearch<span class="token operator">-</span>monitor             <span class="token operator">#</span> 监控主模块
├── musicsearch<span class="token operator">-</span>parent              <span class="token operator">#</span> musicsearch 工程主模块<span class="token punctuation">,</span> 管理整个功能的版本及依赖
│   └── docs                        <span class="token operator">#</span> 放工程相关文档
│   └── database                    <span class="token operator">#</span> 放工程 sql
└── musicsearch<span class="token operator">-</span>support             <span class="token operator">#</span> 支撑模块主模块
    ├── musicsearch<span class="token operator">-</span>code<span class="token operator">-</span>generator  
    ├── musicsearch<span class="token operator">-</span>management<span class="token operator">-</span>system
    └── musicsearch<span class="token operator">-</span>timer<span class="token operator">-</span>task
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>目前重构后的模块, 可能还会有修改.
但是几个主要模块不会再修改了.</p> <blockquote><p>整个项目结构采用 <code>Maven</code> 多模块的方式开发.
目的是为了解决 jar 依赖混乱问题.</p></blockquote> <p><strong>结构规范:</strong></p> <blockquote><p>所有主模块 <code>必须</code> 以 <code>musicsearch-</code> 开始.</p></blockquote> <p>不为别的, 纯属统一前缀, 好看而已</p> <blockquote><p>模块名 <code>必须</code> 全部使用小写, 单词之间作用 <code>-</code> 分隔;</p></blockquote> <h4 id="musicsearch-parent"><a href="#musicsearch-parent" aria-hidden="true" class="header-anchor">#</a> musicsearch-parent</h4> <p>作为整个项目的 灵魂 模块, 管理所有自有模块的版本和依赖关系, 以及整个项目都会使用到的依赖, 比如 <code>lombok</code>, <code>junit</code> 等.</p> <p><img src="http://qiniu.dong4j.info/2019-07-03-15330039207873.jpg" alt="-w1004"> <code>dependencyManagement</code> 标签只是用于声明可能会被使用到的依赖 (就像定义变量), 不会真正添加依赖
<code>dependency</code> 才会真正真正引入依赖</p> <p>这里全部为 <code>musicsearch-project</code> 自有模块, 以后新增的模块也 <code>必须</code> 将声明添加到此标签下
自有模块之间依赖就可直接使用.</p> <p><img src="http://qiniu.dong4j.info/2019-07-03-15330045748142.jpg" alt="-w1004">
使用时, <code>一定不可</code> 添加 version 标签, 不然就会使用修改后的版本, 可能会造成依赖冲突.</p> <hr> <p><code>musicsearch-project</code> 模块下有一个 doc 目录, 用于保存文本文档</p> <p>个人认为, 项目的 <code>技术文档</code> 跟着代码走才是最正确的做法.
随时修改, 随时查看, 代码和文档一起更新提交, 才是最佳实践.</p> <p><img src="http://qiniu.dong4j.info/2019-07-03-15330065876404.jpg" alt="-w1004">
技术文档 <code>推荐</code> 使用 <code>Markdown</code> 语法编写, 最好是 <a href="https://guides.github.com/features/mastering-markdown/" target="_blank" rel="noopener noreferrer">GitHub Markdown 语法<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>这里给出模块说明模板, 每个模块都 <code>必须</code> 有此文档</p> <div class="language-markdown line-numbers-mode"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">#</span> 模块名</span>

<span class="token title important"><span class="token punctuation">##</span> 简介</span>

xxx

<span class="token title important"><span class="token punctuation">##</span> 打包方式</span>

xxx

<span class="token title important"><span class="token punctuation">##</span> 部署方式</span>

xxx

<span class="token title important"><span class="token punctuation">##</span> 使用说明</span>

<span class="token list punctuation">1.</span> xxx
<span class="token list punctuation">2.</span> xxx
<span class="token list punctuation">3.</span> xxx

<span class="token title important"><span class="token punctuation">##</span> 注意事项</span>

xxx

<span class="token title important"><span class="token punctuation">##</span> 更新历史</span>

<span class="token bold"><span class="token punctuation">**</span>更新时间 更新人<span class="token punctuation">**</span></span>

<span class="token list punctuation">1.</span> xxx
<span class="token list punctuation">2.</span> xxx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><hr> <p><code>database</code> 用于保存需求需要更新的 sql 文件, <code>必须</code> 以 <code>.sql</code> 为后缀, <code>必须</code> 是 UTF-8 编码.</p> <h4 id="musicsearch-dependencies"><a href="#musicsearch-dependencies" aria-hidden="true" class="header-anchor">#</a> musicsearch-dependencies</h4> <p>此模块是为了方便管理第三方 jar 依赖而特意添加的, 如果没有此模块, 第三方依赖也可以添加到 <code>musicsearch-project</code>中, 但是会造成过度臃肿, 因此将第三方依赖拆分到此模块中进行统一管理.</p> <blockquote><p>第三方依赖 <code>必须</code> 添加到此模块, 且 <code>必须</code> 将版本号设置到 properties 标签下.
第三方依赖较大可能存在版本冲突, 因此此模块的版本从 <code>0.0.1</code> 开始, 不和 <code>musicsearch-parent</code> 相同, 如果此模块存在依赖问题, 修复后, 需要提升版本号, 并且 <code>必须</code> 写更新记录.</p></blockquote> <p>此模块比较特殊, 修改会比较频繁, 依赖出错大部分出现在此模块, 因此单独写一个 <code>changes.md</code>, 用于记录更新日志.</p> <p><img src="http://qiniu.dong4j.info/2019-07-03-15330079677253.jpg" alt="-w1004"></p> <p><strong>引入新依赖步骤</strong></p> <ol><li>在 <code>musicsearch-dependencies</code> 添加新依赖;</li> <li>将版本信息写入到 pom 的 properties 标签内, 进行统一管理;</li> <li>在需要的模块中, 引入依赖;</li> <li>最后使用 <code>Maven Helper</code> 排查是否存在依赖冲突;</li> <li>如果存在冲突 需要使用 <code>&lt;exclusions&gt;</code> 排除相应的依赖;</li></ol> <h4 id="musicsearch-common"><a href="#musicsearch-common" aria-hidden="true" class="header-anchor">#</a> musicsearch-common</h4> <p><code>musicsearch-project</code> 项目的子模块, 作为最底层的依赖, 提供了公共 util 包, core 包, base 包等基础代码.</p> <blockquote><p>如果被整个项目使用到的代码, 都 <code>必须</code> 放入此模块, 比如 StringUtils 工具类, 一些加密类, 整个项目都能使用到的常量类, 枚举类等;</p></blockquote> <p><strong>必须要提出的是:</strong></p> <p>不要多个模块多个 StringUtils 工具类, 最佳实践 <code>应该</code> 是 <code>musicsearch-common</code> 中编写一个通用的 <code>StringUtils</code> 类, 继承自 <code>org.apache.commons.lang3.StringUtils</code> 类, 业务模块继承 <code>musicsearch-common</code> 模块中的 <code>StringUtils</code> 类, 实现业务相关的字符串处理工具类.(这种方式同样适用于其他类)</p> <h4 id="musicsearch-business"><a href="#musicsearch-business" aria-hidden="true" class="header-anchor">#</a> musicsearch-business</h4> <p>业务模块的父模块, <code>musicsearch-parent</code> 模块的子模块.
用于管理业务模块共用的 jar 依赖.</p> <blockquote><p>所有业务模块 <code>必须</code> 是 <code>musicsearch-business</code> 的子模块</p></blockquote> <p>将业务代码全部整合在一个模块中, 使用业务名进行再分子模块的方式, 管理整个业务代码.
其他共用模块作为框架基础模块, 以后新项目还可以复用.</p> <blockquote><p>不提供 <code>dubbo service</code> 的模块, <code>必须</code> 以 <code>service-</code> 开始.
提供 <code>dubbo service</code> 的模块, <code>必须</code> 以 <code>mservice-</code> 开始.</p></blockquote> <p><code>mservice</code> 的意思是 <code>micro-service</code>. 这样便于区分不同的服务类型, 也方便分组.</p> <p>我们现在使用 <code>dubbo</code> 服务治理框架, 如果以后有可能话, 可以很方便的迁移到 <code>SOFA</code> 或者 <code>Spring Cloud</code> (我就说说, 应该是不可能的事了).</p> <p>业务子模块除了 <code>business-common</code> 模块, 其他子模块都以 Web 应用 或者 JVM 进程直接提供服务.</p> <h4 id="business-common"><a href="#business-common" aria-hidden="true" class="header-anchor">#</a> business-common</h4> <p><code>musicsearch-business</code> 模块的子模块, 依赖于 <code>musicsearch-common</code>.</p> <blockquote><p>业务模块共用的代码 <code>必须</code> 放入 <code>business-common</code> 模块.</p></blockquote> <p>比如所有业务都会用到的 redis key 常量类, 则 <code>必须</code> 放在 <code>business-common</code> 模块中;
而 <code>service-meeting</code> 这个模块的业务用到的 redis key 常量则 <code>必须</code> 放到 <code>service-meeting</code> 模块中.</p> <p>讲究职责分离, 层级分明, 互不干涉; 你走你的阳关道, 我看我的 西虹市首富.</p> <h3 id="模块名"><a href="#模块名" aria-hidden="true" class="header-anchor">#</a> 模块名</h3> <blockquote><p><code>必须</code> 全部为小写, 单词之间 <code>必须</code> 使用 <code>-</code> 分隔.</p></blockquote> <p>不要随心所欲的命名, 要讲究的规则, 不然会走火入魔的.</p> <blockquote><p>provider 模块名 <code>必须</code> 以 <code>mservice-</code> 开头;</p></blockquote> <p>provider 模块也有可能是服务消费者, 这类的模块, 还是 <code>应该</code> 使用 <code>mservice-</code> 开头</p> <p>对于 provider 模块, 至少应该分为 2 层;</p> <ol><li>服务名-interface ,提供给 consumer 的依赖模块</li> <li>服务名-service ,业务处理模块</li></ol> <blockquote><p>服务名-interface 模块 <code>必须</code> 包含用到的实体类, 接口定义, dubbo-consumer-服务名.xml, 共用的 util 类, 枚举类等;</p></blockquote> <p><strong>必须要提出的是:</strong></p> <p><code>dubbo-consumer-服务名.xml</code> 配置文件 <code>应该</code> 由 provider 来维护, 而 consumer 只需要 import 此配置文件即可, 而不是在自己的 Spring 配置文件或者自定义一个 dubbo 配置文件再来写引入的接口.</p> <p>这就是为什么 <code>dubbo-consumer-服务名.xml</code> <code>应该</code> 在 interface 模块的原因.</p> <p>这里看看 migu-game 重构之前的结构(有一些小改动)</p> <p><strong>配置关系:</strong></p> <p><img src="http://qiniu.dong4j.info/2019-07-03-15330426626280.jpg" alt="-w871"></p> <p>这里的 dubbo.xml 即 provider 配置, 前面也说了, 这样的命名方式不够直观, 因此 <code>应该</code> 采用 <code>dubbo-provider-服务名</code> 的方式命名;</p> <p>Spring-config.xml 是主配置, 导入了其他 5 个配置;</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>import</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>spring/dubbo.xml<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>import</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>spring/mybatis.xml<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>import</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>spring/dataSource.xml<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>import</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>classpath*:applicationContext-jms.xml<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>import</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>classpath*:applicationContext-redis.xml<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>applicationContext-jms.xml</code> 和 <code>applicationContext-redis.xml</code> 这 2 个配置原来是放在 web.xml 中的.
这里迁入到 Spring-config.xml 中, 因为 web.xml 只需要负责加载 Spring-config.xml 即可, web.xml 写好之后, 基本不需要修改, 所有配置关系全部在 Spring-config.xml 中管理.</p> <p>那么问题来了
<strong>dubbo 的 consumer 配置在哪里呢?</strong></p> <p>找了半天, 原来在 funclib 模块的 <code>applicationContext-mainflowfunc.xml</code> 配置中...</p> <p><img src="http://qiniu.dong4j.info/2019-07-03-1B05F3A1-A94C-423D-84EC-BD37A9BE588D.png" alt="1B05F3A1-A94C-423D-84EC-BD37A9BE588D"></p> <p>那么问题又来了</p> <p>如果 migu-game 由合肥的同事开发, 需要增加几个接口, 使用 migu-game 服务的是成都的小明同学, 正在开发 funclib, 这个时候请问....</p> <p><strong>小明中午吃了啥?</strong></p> <p><img src="http://qiniu.dong4j.info/2019-07-03-30DC9C5B-919D-4DBE-82A0-90372A0380C0.png" alt="-w278"></p> <blockquote><p>如果 dubbo consumer 配置由 funclib 维护, 那么就要修改 funclib 模块的配置;
如果 dubbo consumer 配置由 migu-game 维护, 合肥的同事只需要提供 migu-game-interface, funclib 只需引入 <code>dubbo-consumer-migugame.xml</code>;</p></blockquote> <p><code>服务名-interface</code> 还应该依赖 <code>dubbo</code> 相关 jar 依赖, 这样 consumer 就不需要自己引入 <code>dubbo</code> 相关依赖了;</p> <p>服务行业嘛, 要做就做全套</p> <p><strong>最佳实践</strong></p> <p>个人认为, 一个 <code>mservice</code> 最好分为 3 层;</p> <ol><li>interface 层;</li> <li>service 层;</li> <li>dao 层;</li></ol> <p>interface 已经说过了;
service 层, 作为业务层, 依赖于 dao 层和 interface 层;</p> <p>各层的 pom 中只依赖每层需要的 jar 依赖. 比如 duubo 的依赖 <code>应该</code> 写在 interface 层, <code>mybatis</code> 和数据库驱动依赖 <code>应该</code> 写在 dao 层, 而 service 层依赖业务相关的 jar.</p> <p>这样将所有依赖下放到不同层中, 以一种插件化的方式提供服务, 导入某层依赖, 连带引入了这层需要的依赖. 这样 jar 依赖关系明确, 也很好管理.</p> <p><code>musicsearch-project</code> 的思想就是这样, 以 <code>分而治之</code> 的方式管理代码和依赖关系, 也就是个解耦的思想.
而不是将所有依赖全部扔到 common 或者 service 中, 方便是方便, 维护起来想死的心都有了.</p> <p>interface 模块, 就是一个提供给 consumer 的说明, 告诉 consumer, 我这个 interface 提供了哪些功能, 没有具体实现.</p> <p>而 API 全称 Application Program Interface, 即应用程序接口, 是一组定义,程序及协议的集合.
因此我将 服务名-api 用于向外提供 rest api 的模块.</p> <p>相关的包名也是如此.</p> <h3 id="包名"><a href="#包名" aria-hidden="true" class="header-anchor">#</a> 包名</h3> <blockquote><p>所有包名 <code>必须</code> 以 <code>com.iflytek.musicsearch</code> 开始</p></blockquote> <p>其他规则:</p> <ul><li>组件模块: <code>com.iflytek.musicsearch.component.组件名</code></li> <li>公共类库: <code>com.iflytek.musicsearch.common</code></li> <li>服务模块: <code>com.iflytek.musicsearch.服务名</code></li></ul> <p><code>推荐</code> 几个常用的包名</p> <ul><li><code>config</code> 用来放配置类</li> <li><code>util</code> 工具类包</li> <li><code>enums</code> 枚举类包</li> <li><code>constant</code> 常量类包 (<code>推荐</code> 将常量按类别定义在不同的常量类中)</li> <li><code>service</code> service 接口包</li> <li><code>service.impl</code> service 接口实现类包</li> <li><code>dao</code> dao 接口包</li> <li><code>interfaces</code> 特指 provider 提供的接口类</li> <li><code>api</code> 特指 rest api</li></ul> <h3 id="类名"><a href="#类名" aria-hidden="true" class="header-anchor">#</a> 类名</h3> <p>类名 <code>必须</code> 使用 UpperCamelCase 风格(首字母都大写), 必须遵从驼峰形式. 例如: StringUtils</p> <blockquote><p>抽象类命名 <code>必须</code> 使用 Abstract 或 Base 开头;
异常类命名 <code>必须</code> 使用 Exception 结尾;
测试类命名 <code>必须</code> 以它要测试的类的名称开始, 以 Test 结尾;
接口实现类 <code>必须</code> 以 Impl 结尾;
API 接口类必须以 <code>Controller</code> 结尾;
ORM接口必须以 <code>Dao</code> 结尾;</p></blockquote> <h3 id="方法名"><a href="#方法名" aria-hidden="true" class="header-anchor">#</a> 方法名</h3> <p>Dao 接口名 <code>推荐</code> 使用以下命名方式</p> <p>新增:</p> <ul><li>add(Entity entity)</li> <li>insert(Entity entity)</li> <li>save(Entity entity)</li></ul> <p>查询:</p> <ul><li>get(Long id)</li> <li>getByXxx</li> <li>findByXxx</li> <li>selectByXxx</li></ul> <p>更新:</p> <ul><li>update(Entity entity)</li> <li>updateByXxx</li></ul> <p>删除:</p> <ul><li>delete(Long id)</li> <li>deleteByXxx</li></ul> <h3 id="属性名"><a href="#属性名" aria-hidden="true" class="header-anchor">#</a> 属性名</h3> <p>这个没什么好说的, 按照 Java 推荐命名方式即可.</p> <blockquote><p>常量命名 <code>必须</code> 全部大写, 单词间用下划线分隔;</p></blockquote> <h2 id="数据库规范"><a href="#数据库规范" aria-hidden="true" class="header-anchor">#</a> 数据库规范</h2> <p>推荐 3 篇文章, 虽然是 mysql 的, 但是都是数据库啊</p> <p><a href="https://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&amp;mid=2651960775&amp;idx=1&amp;sn=1a9c9f4b94dfe71ad2528fb2c84f5ec7&amp;chksm=bd2d001b8a5a890d302d139ea42e9ffde44407738a618865934e40b8e35486b13cafca2933f6&amp;mpshare=1&amp;scene=1&amp;srcid=1228MzgFw9KLVzaHtjHvpb2p%23rd" target="_blank" rel="noopener noreferrer">赶集 mysql 军规<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&amp;mid=2651959906&amp;idx=1&amp;sn=2cbdc66cfb5b53cf4327a1e0d18d9b4a&amp;chksm=bd2d07be8a5a8ea86dc3c04eced3f411ee5ec207f73d317245e1fefea1628feb037ad71531bc&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">58到家数据库30条军规解读<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&amp;mid=2651959910&amp;idx=1&amp;sn=6b6853b70dbbe6d689a12a4a60b84d8b&amp;chksm=bd2d07ba8a5a8eac6783bac951dba345d865d875538755fe665a5daaf142efe670e2c02b7c71&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">再议数据库军规<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="配置规范"><a href="#配置规范" aria-hidden="true" class="header-anchor">#</a> 配置规范</h2> <p>为了解决开发, 测试, 现网部署时手动对比配置, 手动切换配置, 减少人工介入出错的几率, 节约时间等问题, <code>musicsearch-project</code> 采用多环境配置.
一次打包,可部署到多个环境.</p> <p>意思就是: 一次打包, 到处运行.</p> <h3 id="配置分类"><a href="#配置分类" aria-hidden="true" class="header-anchor">#</a> 配置分类</h3> <p><strong>从数据来源可分为:</strong></p> <ul><li>数据库</li> <li>NoSQL</li> <li>文件</li> <li>网络</li></ul> <p><strong>从加载顺序上课分为:</strong></p> <ul><li>启动时加载的配置
<ul><li>dataSource 连接配置</li> <li>Redis 连接配置</li> <li>MQ 连接配置</li> <li>日志配置</li> <li>...</li></ul></li> <li>运行期间动态获取
<ul><li>字典数据</li></ul></li></ul> <p>其实最容易出错的且影响最大的就是运行期间动态获取的配置, 字典数据改错了就会影响现网业务, 而且不好排查.
连接配置启动时就需要, 如果错误可能会导致启动失败, 这类问题比较容易排查.</p> <h3 id="local-环境"><a href="#local-环境" aria-hidden="true" class="header-anchor">#</a> local 环境</h3> <p>以前在开发时, 使用的 dev 环境. 可能会将某几个配置修改成本地环境或者 test 环境进行开发, 开发完成后, 又<code>需要逐个改回来</code>;
改动的配置太多, 部分配置<code>忘记改回来</code>还提交了, 悲剧了;</p> <p>local 环境专门解决以上问题.
最初是一个空配置, 我们拉取代码后根据自己的环境修改 local 配置, 然后使用 idea <code>忽略提交</code>功能, 忽略此文件.
每个开发者互不影响, 开发时只需要修改 local 环境即可, <code>不该</code> 直接修改其他环境配置, 避免环境问题造成线上问题</p> <h3 id="dev-环境"><a href="#dev-环境" aria-hidden="true" class="header-anchor">#</a> dev 环境</h3> <p>现在的服务太多, 我们开发时不可能每个都启动起来, 这时我们可以将一些公共的服务部署到 dev 服务器, 这个配置就是 dev 环境的配置了, 一旦配置好, <code>不该</code> 轻易修改.</p> <h3 id="test-环境"><a href="#test-环境" aria-hidden="true" class="header-anchor">#</a> test 环境</h3> <p>和 dev 环境差不多, 只是一些连接配置不一样, <code>不该</code> 轻易修改.</p> <h3 id="prod-环境"><a href="#prod-环境" aria-hidden="true" class="header-anchor">#</a> prod 环境</h3> <p>生产环境经常改动的就是字典数据, 现在的字段数据太复杂了.</p> <p>最好的方式是通过 kv 键值对, value 只是简单的字符串而已, 不要是一个复杂的 json, 这样能非常友好的管理所有配置, 修改配置也不容易出错.</p> <p>redis 构建工具我了解当的一个作用是为了防止修改出错, 做了一个保护措施.
先保存到数据库中, 检查一下, 确保没出错后使用构建工具同步到 redis.</p> <p>如果是这个原因的话, 我想能不能使用一个弹出框显示修改前与修改后的值, 然后二次确认?
确认后修改数据库, 同时更新 redis.</p> <p>获取动态数据的方式:</p> <p>首先从 redis 中获取, 如果没有则从数据库中获取, 然后更新到 redis;
如果有则直接返回.</p> <p>后台系统修改字典数据且二次确认后, 更新数据库和 redis.</p> <p>这里有一个事务问题.
比如后台系统修改完字段数据后,更新数据库成功, 但是更新 redis 失败, 这个时候 redis 中就是旧数据.</p> <p><strong>解决方案:</strong></p> <ol><li>后台系统二次确认修改;</li> <li>更新数据库;</li> <li>将 redis 相应的 key 设置为失效;</li></ol> <p><strong>分析:</strong></p> <ol><li>第 2 步失败, 直接返回修改失败, 不会发生事务问题, 数据也不会被修改;</li> <li>第 2 步成功, 第 3 步失败;
<ol><li>此时应用查询字典数据时, redis 为旧数据(可以使用重试来解决)</li></ol></li> <li>第 2 步成功, 第 3 步成功;
<ol><li>此时应用查询字典数据时, redis 没有, 则去数据库中查询最新, 然后再更新到 redis 中.</li></ol></li></ol> <h3 id="dubbo-配置文件"><a href="#dubbo-配置文件" aria-hidden="true" class="header-anchor">#</a> Dubbo 配置文件</h3> <blockquote><p>消费者配置文件名 <code>必须</code> 以 <code>dubbo-consumer-服务名.xml</code> 命名.
服务提供者配置文件名 <code>必须</code> 以 <code>dubbo-provider-服务名.xml</code> 命名.</p></blockquote> <p>配置名区分消费者和生产者, 这样职责明确, 方便搜索查看. 最操蛋的是搜索出几十个 dubbo.xml 配置, 还得一个个点进入看是消费者还是生产者配置.</p> <blockquote><p>消费者配置 <code>必须</code> 单独写在 <code>dubbo-consumer-服务名.xml</code> 中, 不要写在  Spring 配置中.</p></blockquote> <p>配置尽量分开到不同到配置文件中, 最后使用 import 聚合起来. 需要修改配置时, 能明确知道去哪个配置文件中修改.
你见 <code>葵花宝典</code> 里面写了怎么自宫的详细教程吗? 最多也就引用一下, <code>欲练此功, 必先自宫</code>.</p> <blockquote><p>引入配置不要写在 web.xml, <code>必须</code> 使用 import 在 Spring 主配置文件中引入.</p></blockquote> <p><code>musicsearch-project</code> 不需要担心这个问题, 因为 web.xml 已经被干掉了 🤣</p> <h3 id="spring-配置文件"><a href="#spring-配置文件" aria-hidden="true" class="header-anchor">#</a> Spring 配置文件</h3> <ul><li>SpringMVC 配置文件统一命名: <code>spring-mvc.xml</code></li> <li>Web 应用的 Spring 配置文件统一命名: <code>spring-context.xml</code></li> <li>其他组件的 Spring 配置文件统一命名: 模块名.xml</li> <li>Spring Boot 应用的配置文件统一使用 application.properties</li></ul> <p><code>musicsearch-project</code> 使用 Spring Boot 为基础框架, 因此 <code>spring-mvc.xml</code> 和 <code>spring-context.xml</code> 已经使用 Java Config 的方式代替.</p> <p><strong>自动配置类 <code>必须</code> 以 服务名+Configuration 方式命名</strong> <strong>启动类 <code>必须</code> 以 服务名+Application 方式命名</strong> <strong>单元测试主类 <code>必须</code> 以 服务名+ApplicationTest 方式命名</strong></p> <h2 id="maven"><a href="#maven" aria-hidden="true" class="header-anchor">#</a> Maven</h2> <p>原来的项目是由多个模块由不同的 Maven 管理, 造成编译,打包,debug 麻烦, 依赖关系复杂, 版本随意, 同一个模块多个不同版本, 维护困难.</p> <p>为了解决以上问题, 现在将所有模块通过一个 主 pom 进行管理, 所有模块全部在 <code>musicsearch-porject</code> 目录下.</p> <p>优点如下:</p> <ul><li>debug 时方便, 想在哪儿打断点就在哪儿打断点. 随处 debug;</li> <li>能借助 IDEA 进行全局重构;</li> <li>jar 版本统一管理</li> <li>绝对不会出现相同 jar 多个相同版本的问题.</li></ul> <h3 id="pom-规范"><a href="#pom-规范" aria-hidden="true" class="header-anchor">#</a> pom 规范</h3> <blockquote><p>groupId <code>必须</code> 为 <code>com.iflytek</code>
artifactId <code>必须</code> 与 模块名相同
version <code>必须</code> 与 父 pom version 相同
<code>必须</code> 显式指定 <code>packaging</code></p></blockquote> <p>如果没有设置 packaging 标签, 默认打包为 jar 格式, 这里 <code>必须</code> 设置此标签, 明确指定打包格式.</p> <blockquote><p><code>必须</code> 写 <code>description</code> 标签</p></blockquote> <p>为此 pom 添加必要的描述信息</p> <blockquote><p>第三方依赖 <code>必须</code> 添加到 <code>musicsearch-dependencies</code> pom 中;
如果 Maven 中央仓库没有的 jar 包, 从网上下载后, <code>必须</code> 上传到公司的 Maven, 不能直接使用 jar 包</p></blockquote> <ol><li>搜索 Maven 中央仓库, 关键字 + maven;</li> <li>搜索不到则找到 jar 上传到公司 Maven 仓库</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code># 安装到私服 
# DgroupId和DartifactId构成了该jar包在pom.xml的坐标, 项目就是依靠这两个属性定位. 自己起名字也行.  
# Dfile表示需要上传的jar包的绝对路径.  
# Durl私服上仓库的位置, 打开nexus——&gt;repositories菜单, 可以看到该路径.  
# DrepositoryId服务器的表示id, 在nexus的configuration可以看到.  要与 setting.xml 中的权限 id 一致
# Dversion表示版本信息
mvn deploy:deploy-file -DgroupId=com.xxx -DartifactId=yyy -Dversion=x.x.x -Dpackaging=jar -Dfile=jar-path -Durl=上传地址 -DrepositoryId=thirdparty 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>第三方依赖 <code>必须</code> 将版本迁入 <code>musicsearch-dependencies</code> 到 properties 标签下;
version <code>必须</code> 以 <code>artifactId.version</code> 的方式命名;</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
    ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>socket.io-client.version</span><span class="token punctuation">&gt;</span></span>1.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>socket.io-client.version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        ...
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.socket<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>socket.io-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${socket.io-client.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>由于 <code>musicsearch-project</code> 使用 Spring Boot 开发, 版本为 1.5.8.RELEASE.
Spring Boot 每个版本都有一个 <code>spring-boot-dependencies</code> 项目用来维护所有第三方 jar 版本和 Maven 插件版本.</p> <p><img src="http://qiniu.dong4j.info/2019-07-03-15330921723159.jpg" alt="-w1087"></p> <p>我们直接使用 <code>spring-boot-dependencies</code> 中相关依赖的版本, 能有效减少版本冲突.</p> <blockquote><p>如果我们新增的第三方包已经在 <code>spring-boot-dependencies</code> 声明, 则 <code>必须</code> 使用 <code>spring-boot-dependencies</code> 规定的版本, 即删除 version 标签.</p></blockquote> <p>怎么查看新引入的依赖是否在 <code>spring-boot-dependencies</code> 被声明了呢, 很简单</p> <p>比如我需要添加如下依赖到模块中</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.16.14<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>整个操作如下图所示:</p> <p><img src="http://qiniu.dong4j.info/2019-07-03-2018-08-01%2011.03.20.gif" alt="2018-08-01 11.03.20"></p> <p>我们新增的 lombok 版本为 1.16.14
但是当加入 pom 之后, 左边出现了一个向上的箭头, 点过去之后, 发现此依赖已经在 <code>spring-boot-dependencies</code> 被声明了, 并且版本为 1.16.18, 因此删除 version 就可以了.</p> <p><strong>添加新依赖的步骤:</strong></p> <ol><li>选择合适的模块, 直接粘贴 maven 依赖配置到 pom 中,</li> <li>如果左边出现了向上的箭头, 则删除 version 标签, 搞定;</li> <li>如果没有, 则将此依赖配置粘贴到 <code>musicsearch-dependencies</code> 中, 将 version 添加到 properties 标签中;</li> <li>最后删除最开始那个配置的 version;</li></ol> <p><code>spring-boot-dependencies</code> 不可能定义到所有的依赖, 因此这里就有了 <code>musicsearch-dependencies</code> 这个模块, 用来管理项目需要但是没有在 <code>spring-boot-dependencies</code> 中定义的 jar 依赖.</p> <h2 id="日志规范"><a href="#日志规范" aria-hidden="true" class="header-anchor">#</a> 日志规范</h2> <blockquote><p><code>推荐</code> 使用 <code>@Slf4j</code> 获取 <code>log</code> 实例</p></blockquote> <p>使用 <code>lombok</code> 插件, 直接使用 @Slf4j 代替获取 log 实例的冗余代码.</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>slf4j</span><span class="token punctuation">.</span><span class="token class-name">Logger</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>slf4j</span><span class="token punctuation">.</span><span class="token class-name">LoggerFactory</span><span class="token punctuation">;</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">Xxx</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p><code>必须</code> 使用 <code>log4j2</code> 日志框架</p></blockquote> <p>统一使用效率更高的 log4j2 日志框架</p> <blockquote><p>日志输出到文件的编码 <code>必须</code> 为 UTF-8</p></blockquote> <h3 id="日志配置名"><a href="#日志配置名" aria-hidden="true" class="header-anchor">#</a> 日志配置名</h3> <blockquote><p>Web 应用或者通过 JVM 进程提供服务的应用, <code>必须</code> 使用 <code>log4j2-spring.xml</code> 命名</p></blockquote> <p>Spring Boot 官方推荐优先使用带有 -spring 的文件名作为日志配置（如使用 log4j2-spring.xml, 而不是 log4j2.xml）</p> <p>原理可以查看</p> <p><code>Log4J2LoggingSystem.getCurrentlySupportedConfigLocations()</code> <code>AbstractLoggingSystem.getSpringConfigLocations()</code></p> <h3 id="输出样式"><a href="#输出样式" aria-hidden="true" class="header-anchor">#</a> 输出样式</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>env: %d{yyyy.MM.dd HH:mm:ss.SSS} [%5p] ${sys:PID} -- [%15.15t] %-40.40c{1.} : %m%n%xwEx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>输出内容元素具体如下:</p> <ul><li>环境名</li> <li>时间日期 — 精确到毫秒</li> <li>日志级别 — ERROR, WARN, INFO, DEBUG or TRACE</li> <li>进程ID</li> <li>分隔符 — <code>--</code> 标识实际日志的开始</li> <li>线程名 — 方括号括起来（可能会截断控制台输出）</li> <li>Logger名 — 通常使用源代码的类名</li> <li>日志内容</li></ul> <p>效果 :</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>dev: 2018.08.01 15:02:25.153  INFO 75012 -- [  restartedMain] c.i.m.m.MeetingApplication : Starting MeetingApplication on dong4j with PID 75012 (/Users/codeai/Develop/work/ifly/musicsearch-project/musicsearch-business/service-meeting/target/classes started by codeai in /Users/codeai/Develop/work/ifly/musicsearch-project)
dev: 2018.08.01 15:02:25.154 DEBUG 75012 -- [  restartedMain] c.i.m.m.MeetingApplication : Running with Spring Boot v1.5.8.RELEASE, Spring v4.3.12.RELEASE
dev: 2018.08.01 15:02:25.155  INFO 75012 -- [  restartedMain] c.i.m.m.MeetingApplication : The following profiles are active: oracle
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="日志保存路径"><a href="#日志保存路径" aria-hidden="true" class="header-anchor">#</a> 日志保存路径</h3> <p>日志路径统一管理, 确保每台服务器上的日志都在同一目录下</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;property name=&quot;LOG_BASE_FOLDER&quot;&gt;/path/to/logs/${APP_NAME}&lt;/property&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>/path/to/logs/</code> 再议, 只要是一个有读写权限的目录且好记就可以了, 关键是保持统一.</p> <blockquote><p>最后 <code>必须</code> 通过 APP_NAME 参数区分应用.</p></blockquote> <h3 id="日志归档"><a href="#日志归档" aria-hidden="true" class="header-anchor">#</a> 日志归档</h3> <blockquote><p>日志文件 <code>必须</code> 1 天归档一次, 压缩文件上限 <code>建议</code> 为 200MB</p></blockquote> <p>每天归档日志, 方便按日志查询日志</p> <h2 id="单元测试规范"><a href="#单元测试规范" aria-hidden="true" class="header-anchor">#</a> 单元测试规范</h2> <blockquote><p>所有模块都 <code>必须</code> 有单元测试, 而不是使用 <code>main()</code> 来进行测试;</p></blockquote> <p>IDEA 添加单元测试类非常简单</p> <p><img src="http://qiniu.dong4j.info/2019-07-03-2018-07-31%2000.15.33.gif" alt="2018-07-31 00.15.33"></p> <p>直接通过快捷键自动生成单元测试类.</p> <blockquote><p>集成测试时, <code>必须</code> 继承主测试类;</p></blockquote> <p>在每个 Web 模块中, 都会有一个 XxxApplicationTest 测试父类, 用于整合配置类, 测试端口随机等功能.</p> <p><img src="http://qiniu.dong4j.info/2019-07-03-15329680004537.jpg" alt="-w983"></p> <p>其他集成测试类只需要继承此父类即可, 不需要写重复的注解</p> <p><img src="http://qiniu.dong4j.info/2019-07-03-15329681167623.jpg" alt="-w983"></p> <p>默认是单元测试 <code>必须</code> 全部通过才能打包, 当往往由于单元测试编写不规范造成打包失败, 编写好的单元测试难度也非常大, 因此这里不强制要求.</p> <p>使用 3 种方式忽略单元测试</p> <p><strong>方式1:</strong></p> <p><code>推荐</code> 这种</p> <p>使用变量</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.test.skip</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.test.skip</span><span class="token punctuation">&gt;</span></span>  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>或者</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>skipTests</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>skipTests</span><span class="token punctuation">&gt;</span></span>  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>方式2:</strong></p> <p>使用 mvn 命令</p> <div class="language-lua line-numbers-mode"><pre class="language-lua"><code>mvn package <span class="token operator">-</span>Dmaven<span class="token punctuation">.</span>test<span class="token punctuation">.</span>skip<span class="token operator">=</span><span class="token keyword">true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>方式3:</strong></p> <p>使用插件</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-surefire-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${maven-surefire-plugin.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>  
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>skipTests</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>skipTests</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>方式1 与方式2 的区别在于:</p> <p><code>skipTests</code> 不执行测试用例, 但编译测试用例类生成相应的 class 文件至 target/test-classes 下
<code>maven.test.skip</code> 不但跳过单元测试的运行, 也跳过测试代码的编译</p></div> <!----> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">7/3/2019, 6:17:56 PM</span></div></footer> <!----> </main> <div class="valine-wrapper" data-v-0162251c><div id="valine" data-v-0162251c></div></div></div> <div class="back-to-ceiling" style="right:1rem;bottom:3rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;background-color:rgba(231, 234, 241,.5);display:none;" data-v-d0bfeaa4 data-v-d0bfeaa4><i class="iconfont reco-up" data-v-d0bfeaa4></i></div></div></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.23d4d300.js" defer></script><script src="/assets/js/4.28fd9624.js" defer></script><script src="/assets/js/1.928d15b1.js" defer></script><script src="/assets/js/59.3b16a882.js" defer></script>
  </body>
</html>
