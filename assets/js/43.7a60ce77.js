(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{298:function(t,a,s){"use strict";s.r(a);var n=s(0),e=Object(n.a)({},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("div",{staticClass:"tip custom-block"},[s("p",[t._v("在 Java 中, GC 的对象是堆空间和永久区")])]),t._v(" "),s("p",[t._v("[toc]")]),t._v(" "),s("h2",{attrs:{id:"回收算法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#回收算法","aria-hidden":"true"}},[t._v("#")]),t._v(" 回收算法")]),t._v(" "),s("h3",{attrs:{id:"引用计数算法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#引用计数算法","aria-hidden":"true"}},[t._v("#")]),t._v(" 引用计数算法")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://qiniu.dong4j.info/006y8lVagw1fbdl4dx0vgj30t907s74d.jpg",alt:""}})]),t._v(" "),s("ul",[s("li",[t._v("Java 不再使用")]),t._v(" "),s("li",[t._v("Python,COM,ActionScript3 使用")]),t._v(" "),s("li",[t._v("性能差")]),t._v(" "),s("li",[t._v("不能解决循环引用问题")])]),t._v(" "),s("h3",{attrs:{id:"标记-清除算法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#标记-清除算法","aria-hidden":"true"}},[t._v("#")]),t._v(" 标记-清除算法")]),t._v(" "),s("h4",{attrs:{id:"标记阶段"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#标记阶段","aria-hidden":"true"}},[t._v("#")]),t._v(" 标记阶段")]),t._v(" "),s("p",[t._v("在标记阶段, 首先通过根节点, 标记所有从根节点开始的可达对象")]),t._v(" "),s("h4",{attrs:{id:"清除阶段"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#清除阶段","aria-hidden":"true"}},[t._v("#")]),t._v(" 清除阶段")]),t._v(" "),s("p",[t._v("清除所有未被标记的对象")]),t._v(" "),s("h3",{attrs:{id:"标记-压缩算法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#标记-压缩算法","aria-hidden":"true"}},[t._v("#")]),t._v(" 标记-压缩算法")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://qiniu.dong4j.info/006y8lVajw1fbdl7wizfhj30sb09raa4.jpg",alt:""}})]),t._v(" "),s("p",[t._v("标记-压缩算法适合用于存活对象较多的场合, 如老年代.\n它在标记-清除算法的基础上做了一些优化.")]),t._v(" "),s("h4",{attrs:{id:"标记阶段-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#标记阶段-2","aria-hidden":"true"}},[t._v("#")]),t._v(" 标记阶段")]),t._v(" "),s("p",[t._v("从根节点开始, 对所有可达对象做一次标记")]),t._v(" "),s("h4",{attrs:{id:"压缩阶段"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#压缩阶段","aria-hidden":"true"}},[t._v("#")]),t._v(" 压缩阶段")]),t._v(" "),s("p",[t._v("将所有存活对象压缩到内存一端,然后清除边界外的所有空间")]),t._v(" "),s("h3",{attrs:{id:"复制算法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#复制算法","aria-hidden":"true"}},[t._v("#")]),t._v(" 复制算法")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://qiniu.dong4j.info/006y8lVajw1fbdl8i2o58j30og0br3z0.jpg",alt:""}})]),t._v(" "),s("ul",[s("li",[t._v("与标记-清除算法相比,复制算法是一种相对高效的回收方式")]),t._v(" "),s("li",[t._v("不适合存活对象较多的场合,如老年代")]),t._v(" "),s("li",[t._v("将原来的内存分为相同大小的两块,每次只是用其中一块,在垃圾回收时,将正在是用的内存中的对象复制到未使用的内存块中,之后清除正在是用的内存中的所有对象,交换两个内存的角色,完成垃圾回收")])]),t._v(" "),s("p",[t._v("问题:")]),t._v(" "),s("ul",[s("li",[t._v("空间浪费,只是用了一半")])]),t._v(" "),s("p",[t._v("是用标记清理和复制算法配置回收垃圾")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://qiniu.dong4j.info/006y8lVagw1fbdle6nt9fj30ni0b3wex.jpg",alt:""}})]),t._v(" "),s("ol",[s("li",[t._v("在最上面那块大的区域产生新对象.")]),t._v(" "),s("li",[t._v("大对象不太适合在复制空间, 因为复制空间的容量是有限的, 所以需要一个大的空间做担保, 所以让老年代做担保. 这样产生的大对象直接进入老年代.")]),t._v(" "),s("li",[t._v("每一次GC, 对象的年龄就会+1, 一个对象在几次GC后仍然没有被回收, 则这个对象就是一个老年对象. 老年对象是一个长期被引用的对象, 老年对象将被放入老年代.")]),t._v(" "),s("li",[t._v("步骤1中产生的小对象, 将进入到复制空间. 原先复制空间中的新对象也将被复制到另一块复制空间")]),t._v(" "),s("li",[t._v("清空垃圾对象")])]),t._v(" "),s("p",[s("img",{attrs:{src:"http://qiniu.dong4j.info/006y8lVagw1fbdlzjm3ugj30mg08sweg.jpg",alt:""}})]),t._v(" "),s("p",[t._v("一个堆分为new generation(新生代) , tenured generation(老年代)和compacting perm gen.\n而new generation分为eden space,from space（有些地方称为s0和s1, 表示幸存代） , to space.\neden space就是上面那种图中, 对象产生的地方.\nfrom space和to space是两块大小一样的区域, 是上图中的复制空间.\nnew generation的可用总空间就是eden space+一块复制空间（另一块不算）, 但是根据new generation的地址访问可以算出是eden space + 两块复制空间区域, 所以复制算法浪费了一部分空间.")]),t._v(" "),s("h2",{attrs:{id:"分代思想"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#分代思想","aria-hidden":"true"}},[t._v("#")]),t._v(" 分代思想")]),t._v(" "),s("p",[t._v("依据对象的存活周期进行分类, 短命对象归为新生代, 长命对象归为老年代.\n根据不同代的特点, 选取合适的收集算法")]),t._v(" "),s("ul",[s("li",[t._v("少量对象存活, 适合复制算法")]),t._v(" "),s("li",[t._v("大量对象存活, 适合标记清理或者标记压缩")]),t._v(" "),s("li",[t._v("进入老年代的对象有两种情况:\n"),s("ol",[s("li",[t._v("新生代空间不够, 老年代做担保存放一些大对象")]),t._v(" "),s("li",[t._v("某些对象多次GC后仍然存在, 进入老年代.")])])])]),t._v(" "),s("p",[t._v("老年代的大多数对象都是第2种情况, 所以老年代的对象的生命周期比较长, GC的发生也比较少, 会有大量对象存活, 所以不用复制算法, 而改为标记清理或者标记压缩."),s("br"),t._v("\n所有的算法, 需要能够识别一个垃圾对象, 因此需要给出一个可触及性的定义")]),t._v(" "),s("h3",{attrs:{id:"可触及性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#可触及性","aria-hidden":"true"}},[t._v("#")]),t._v(" 可触及性")]),t._v(" "),s("p",[t._v("从根节点可以触及到这个对象\n可复活的\n一旦所有引用被释放, 就是可复活状态\n因为在finalize()中可能复活该对象\n不可触及的\n在finalize()后, 可能会进入不可触及状态\n不可触及的对象不可能复活\n可以回收\n下面举个例子来说明可复活这个状态:")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CanReliveObj")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CanReliveObj")]),t._v(" obj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("protected")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("finalize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Throwable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("finalize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"CanReliveObj finalize called"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tobj "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"I am CanReliveObj"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tobj "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CanReliveObj")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tobj "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 可复活")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("gc")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"obj 是 null"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"obj 可用"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"第二次gc"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tobj "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 不可复活")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("gc")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"obj 是 null"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"obj 可用"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br"),s("span",{staticClass:"line-number"},[t._v("33")]),s("br"),s("span",{staticClass:"line-number"},[t._v("34")]),s("br"),s("span",{staticClass:"line-number"},[t._v("35")]),s("br")])]),s("p",[t._v("输出:")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("CanReliveObj finalize called\nobj 可用\n第二次gc\nobj 是 null\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("p",[t._v("一般我们认为, 对象赋值null后, 对象就可以被GC了, 在上述实例中, 在finalize中, 又将obj=this, 使对象复活. 因为finalize只能调用一次, 所以第二次GC时, obj被回收.\n因此对于finalize会有这样的建议:")]),t._v(" "),s("ul",[s("li",[t._v("经验: 避免使用finalize(), 操作不慎可能导致错误.")]),t._v(" "),s("li",[t._v("finalize优先级低, 何时被调用（在GC时被调用, 何时发生GC不确定） 不确定")]),t._v(" "),s("li",[t._v("可以使用try-catch-finally来替代它")])]),t._v(" "),s("p",[t._v("另外在之前, 我们一直在提到从根出发, 那么根是指哪些对象呢？")]),t._v(" "),s("ul",[s("li",[t._v("栈中引用的对象")]),t._v(" "),s("li",[t._v("方法区中静态成员或者常量引用的对象（全局对象）")]),t._v(" "),s("li",[t._v("JNI方法栈中引用对象")])]),t._v(" "),s("h2",{attrs:{id:"stop-the-world"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#stop-the-world","aria-hidden":"true"}},[t._v("#")]),t._v(" Stop-The-World")]),t._v(" "),s("p",[t._v("Stop-The-World是Java中一种全局暂停的现象.\n全局停顿, 所有Java代码停止, native代码可以执行, 但不能和JVM交互")]),t._v(" "),s("p",[t._v("多半由于GC引起, 当然Dump线程、死锁检查、堆Dump都有可能引起Stop-The-World")]),t._v(" "),s("p",[s("strong",[t._v("GC时为什么会有全局停顿？")]),t._v("\n类比在聚会时打扫房间, 聚会时很乱, 又有新的垃圾产生, 房间永远打扫不干净, 只有让大家停止活动了, 才能将房间打扫干净.")]),t._v(" "),s("p",[s("strong",[t._v("危害")])]),t._v(" "),s("ul",[s("li",[t._v("长时间服务停止, 没有响应")]),t._v(" "),s("li",[t._v("遇到HA系统, 可能引起主备切换, 严重危害生产环境.")])]),t._v(" "),s("p",[s("strong",[t._v("新生代的GC（Minor GC）, 停顿时间比较短")]),t._v(" "),s("strong",[t._v("老年代的GC（Full GC）, 停顿时间可能比较长")])]),t._v(" "),s("h2",{attrs:{id:"串行收集器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#串行收集器","aria-hidden":"true"}},[t._v("#")]),t._v(" 串行收集器")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://qiniu.dong4j.info/006y8lVagw1fbdm0bi2f2j30hm0ae3yp.jpg",alt:""}})]),t._v(" "),s("p",[t._v("串行收集器是最古老, 最稳定以及效率高的收集器\n可能会产生较长的停顿, 只使用一个线程去回收\n-XX:+UseSerialGC")]),t._v(" "),s("ul",[s("li",[t._v("新生代、老年代使用串行回收")]),t._v(" "),s("li",[t._v("新生代复制算法")]),t._v(" "),s("li",[t._v("老年代标记-压缩")])]),t._v(" "),s("p",[s("img",{attrs:{src:"http://qiniu.dong4j.info/006y8lVagw1fbdluo62m3j30a205rmx3.jpg",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"并行收集器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#并行收集器","aria-hidden":"true"}},[t._v("#")]),t._v(" 并行收集器")]),t._v(" "),s("h3",{attrs:{id:"parnew"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#parnew","aria-hidden":"true"}},[t._v("#")]),t._v(" ParNew")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://qiniu.dong4j.info/006y8lVagw1fbdm29r1prj30hm0camxi.jpg",alt:""}})]),t._v(" "),s("ul",[s("li",[t._v("-XX:+UseParNewGC（new代表新生代, 所以适用于新生代）\n"),s("ul",[s("li",[t._v("新生代并行")]),t._v(" "),s("li",[t._v("老年代串行")])])]),t._v(" "),s("li",[t._v("Serial收集器新生代的并行版本")]),t._v(" "),s("li",[t._v("复制算法")]),t._v(" "),s("li",[t._v("多线程, 需要多核支持")]),t._v(" "),s("li",[t._v("-XX:ParallelGCThreads 限制线程数量")])]),t._v(" "),s("h3",{attrs:{id:"parallel"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#parallel","aria-hidden":"true"}},[t._v("#")]),t._v(" Parallel")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://qiniu.dong4j.info/006y8lVajw1fbdm5cnqooj30kq0ciq3b.jpg",alt:""}})]),t._v(" "),s("ul",[s("li",[s("p",[t._v("类似ParNew")])]),t._v(" "),s("li",[s("p",[t._v("新生代复制算法")])]),t._v(" "),s("li",[s("p",[t._v("老年代 标记-压缩")])]),t._v(" "),s("li",[s("p",[t._v("更加关注吞吐量")])]),t._v(" "),s("li",[s("p",[t._v("-XX:+UseParallelGC")])]),t._v(" "),s("li",[s("p",[t._v("使用Parallel收集器 + 老年代串行")])]),t._v(" "),s("li",[s("p",[t._v("-XX:+UseParallelOldGC")])]),t._v(" "),s("li",[s("p",[t._v("使用Parallel收集器+ 并行老年代")])]),t._v(" "),s("li",[s("p",[t._v("-XX:MaxGCPauseMills")]),t._v(" "),s("ul",[s("li",[t._v("最大停顿时间, 单位毫秒")]),t._v(" "),s("li",[t._v("GC尽力保证回收时间不超过设定值")])])]),t._v(" "),s("li",[s("p",[t._v("-XX:GCTimeRatio")]),t._v(" "),s("ul",[s("li",[t._v("0-100的取值范围")]),t._v(" "),s("li",[t._v("垃圾收集时间占总时间的比")]),t._v(" "),s("li",[t._v("默认99, 即最大允许1%时间做GC")])])]),t._v(" "),s("li",[s("p",[t._v("这两个参数是矛盾的. 因为停顿时间和吞吐量不可能同时调优")])])]),t._v(" "),s("h3",{attrs:{id:"cms收集器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cms收集器","aria-hidden":"true"}},[t._v("#")]),t._v(" CMS收集器")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://qiniu.dong4j.info/006y8lVagw1fbdm71rfh8j30t40e2753.jpg",alt:""}})]),t._v(" "),s("ul",[s("li",[s("p",[t._v("Concurrent Mark Sweep 并发标记清除")])]),t._v(" "),s("li",[s("p",[t._v("标记-清除算法")])]),t._v(" "),s("li",[s("p",[t._v("与标记-压缩相比")])]),t._v(" "),s("li",[s("p",[t._v("并发阶段会降低吞吐量")])]),t._v(" "),s("li",[s("p",[t._v("老年代收集器（新生代使用ParNew）")])]),t._v(" "),s("li",[s("p",[t._v("-XX:+UseConcMarkSweepGC")])]),t._v(" "),s("li",[s("p",[t._v("初始标记")]),t._v(" "),s("ul",[s("li",[t._v("根可以直接关联到的对象")]),t._v(" "),s("li",[t._v("速度快")])])]),t._v(" "),s("li",[s("p",[t._v("并发标记（和用户线程一起）")]),t._v(" "),s("ul",[s("li",[t._v("主要标记过程, 标记全部对象")])])]),t._v(" "),s("li",[s("p",[t._v("重新标记")]),t._v(" "),s("ul",[s("li",[t._v("由于并发标记时, 用户线程依然运行, 因此在正式清理前, 再做修正")])])]),t._v(" "),s("li",[s("p",[t._v("并发清除（和用户线程一起）")]),t._v(" "),s("ul",[s("li",[t._v("基于标记结果, 直接清理对象")])])])]),t._v(" "),s("h4",{attrs:{id:"特点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#特点","aria-hidden":"true"}},[t._v("#")]),t._v(" 特点")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("尽可能降低停顿")])]),t._v(" "),s("li",[s("p",[t._v("会影响系统整体吞吐量和性能")]),t._v(" "),s("ul",[s("li",[t._v("比如, 在用户线程运行过程中, 分一半CPU去做GC, 系统性能在GC阶段, 反应速度就下降一半")])])]),t._v(" "),s("li",[s("p",[t._v("清理不彻底")]),t._v(" "),s("ul",[s("li",[t._v("因为在清理阶段, 用户线程还在运行, 会产生新的垃圾, 无法清理")])])]),t._v(" "),s("li",[s("p",[t._v("因为和用户线程一起运行, 不能在空间快满时再清理")]),t._v(" "),s("ul",[s("li",[t._v("-XX:CMSInitiatingOccupancyFraction设置触发GC的阈值")]),t._v(" "),s("li",[t._v("如果不幸内存预留空间不够, 就会引起concurrent mode failure")])])]),t._v(" "),s("li",[s("p",[t._v("-XX:+ UseCMSCompactAtFullCollection Full GC后, 进行一次整理")]),t._v(" "),s("ul",[s("li",[t._v("整理过程是独占的, 会引起停顿时间变长")])])]),t._v(" "),s("li",[s("p",[t._v("-XX:+CMSFullGCsBeforeCompaction")]),t._v(" "),s("ul",[s("li",[t._v("设置进行几次Full GC后, 进行一次碎片整理")])])]),t._v(" "),s("li",[s("p",[t._v("-XX:ParallelCMSThreads")]),t._v(" "),s("ul",[s("li",[t._v("设定CMS的线程数量")])])])]),t._v(" "),s("p",[t._v("CMS的提出是想改善GC的停顿时间, 在GC过程中的确做到了减少GC时间, 但是同样导致产生大量内存碎片, 又需要消耗大量时间去整理碎片, 从本质上并没有改善时间.")]),t._v(" "),s("h2",{attrs:{id:"gc-参数整理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gc-参数整理","aria-hidden":"true"}},[t._v("#")]),t._v(" GC 参数整理")]),t._v(" "),s("p",[t._v("-XX:+UseSerialGC: 在新生代和老年代使用串行收集器\n-XX:SurvivorRatio: 设置eden区大小和survivior区大小的比例\n-XX:NewRatio:新生代和老年代的比\n-XX:+UseParNewGC: 在新生代使用并行收集器\n-XX:+UseParallelGC : 新生代使用并行回收收集器\n-XX:+UseParallelOldGC: 老年代使用并行回收收集器\n-XX:ParallelGCThreads: 设置用于垃圾回收的线程数\n-XX:+UseConcMarkSweepGC: 新生代使用并行收集器, 老年代使用CMS+串行收集器\n-XX:ParallelCMSThreads: 设定CMS的线程数量\n-XX:CMSInitiatingOccupancyFraction: 设置CMS收集器在老年代空间被使用多少后触发\n-XX:+UseCMSCompactAtFullCollection: 设置CMS收集器在完成垃圾收集后是否要进行一次内存碎片的整理\n-XX:CMSFullGCsBeforeCompaction: 设定进行多少次CMS垃圾回收后, 进行一次内存压缩\n-XX:+CMSClassUnloadingEnabled: 允许对类元数据进行回收\n-XX:CMSInitiatingPermOccupancyFraction: 当永久区占用率达到这一百分比时, 启动CMS回收\n-XX:UseCMSInitiatingOccupancyOnly: 表示只在到达阀值的时候, 才进行CMS回收")])])},[],!1,null,null,null);a.default=e.exports}}]);