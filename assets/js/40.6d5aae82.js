(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{295:function(s,t,e){"use strict";e.r(t);var a=e(0),n=Object(a.a)({},function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("div",{staticClass:"tip custom-block"},[e("p",[s._v("Web服务器一旦发出响应,一个请求响应过程就结束了.\n当再次发出请求时,Web服务器不记得曾就做过的请求,也不记得给用户发出过响应.,这就是http的无状态模式")])]),s._v(" "),e("p",[s._v("当需要跨多个请求需要保留与客户端会话状态时,我们有4种解决方案")]),s._v(" "),e("h2",{attrs:{id:"表单隐藏字段"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#表单隐藏字段","aria-hidden":"true"}},[s._v("#")]),s._v(" 表单隐藏字段")]),s._v(" "),e("p",[e("code",[s._v('<input type="hidden" name="userName" value="...">')]),s._v("\n作用:")]),s._v(" "),e("ol",[e("li",[s._v("对用户在网上的访问进行会话跟踪")]),s._v(" "),e("li",[s._v("为服务器提供预定义的输入")]),s._v(" "),e("li",[s._v("存储动态产生的网页的上下文信息")])]),s._v(" "),e("p",[s._v("缺点: 只有当每个网页是动态生成的才有效")]),s._v(" "),e("h2",{attrs:{id:"cookie"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cookie","aria-hidden":"true"}},[s._v("#")]),s._v(" Cookie")]),s._v(" "),e("p",[s._v("将数据已键值对的形式通过响应保存在客户端\n方法:")]),s._v(" "),e("ol",[e("li",[s._v("Cookie(name,value)")]),s._v(" "),e("li",[s._v("get/setComment(String comment):注释")]),s._v(" "),e("li",[s._v("get/setDomain(String domainPattern):得到/设置应用Cookie的域")]),s._v(" "),e("li",[s._v("setMaxAge(int lifetime) 设置过期时间,默认为负数,表示在关闭浏览器后过期")]),s._v(" "),e("li",[s._v("getMaxAge()")]),s._v(" "),e("li",[s._v("get/setName(String name)")]),s._v(" "),e("li",[s._v("get/setValue(String value)")])]),s._v(" "),e("p",[s._v("将Cookie发送到客户端的步骤")]),s._v(" "),e("ol",[e("li",[s._v("创建一个或多个Cookie")]),s._v(" "),e("li",[s._v("使用setXXX方法设置Cookie的可选属性")]),s._v(" "),e("li",[s._v("使用HttpServletResponse对象的addCookie()方法将Cookie插入到响应头中")])]),s._v(" "),e("p",[s._v("读取客户端传递过来的Cookie的步骤")]),s._v(" "),e("ol",[e("li",[s._v("使用HttpServletRequset对象的getCookie方法返回一个Cookie对象数组")]),s._v(" "),e("li",[s._v("Servlet遍历该数组(getName()),直到找到名称相匹配的Cookie值")])]),s._v(" "),e("h2",{attrs:{id:"session"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#session","aria-hidden":"true"}},[s._v("#")]),s._v(" Session")]),s._v(" "),e("p",[s._v("在服务器端为客户端创建一个唯一的Session对象,用于存放数据.\n在创建Session对象的同时,服务器会为该对象创建一个唯一的SesionID,存储在客户端的Cookie当中")]),s._v(" "),e("p",[s._v("HttpSession接口中的方法")]),s._v(" "),e("ol",[e("li",[s._v("get/setAttribute(String key,Object obj)")]),s._v(" "),e("li",[s._v("removeAttribute(String key)")]),s._v(" "),e("li",[s._v("getCreationTime() :返回第一次创建会话的时间")]),s._v(" "),e("li",[s._v("getLastAccessedTime() :返回容器最后一次得到该会话ID的请求时间")]),s._v(" "),e("li",[s._v("get/setMaxInactiveInterval(int time) :存活时间")]),s._v(" "),e("li",[s._v("invalidate():结束会话")]),s._v(" "),e("li",[s._v("getId()")])]),s._v(" "),e("h3",{attrs:{id:"会话超时管理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#会话超时管理","aria-hidden":"true"}},[s._v("#")]),s._v(" 会话超时管理")]),s._v(" "),e("p",[s._v("结束会话的3种情况")]),s._v(" "),e("ol",[e("li",[s._v("服务器重启或崩溃")]),s._v(" "),e("li",[s._v("调用invalidate()方法")]),s._v(" "),e("li",[s._v("会话超时")])]),s._v(" "),e("p",[s._v("在web.xml中设置会话时间\n单位是分钟")]),s._v(" "),e("div",{staticClass:"language-java line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("session"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\t\n\t"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("session"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("timeout"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("session"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("timeout"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("session"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("在程序中设置超时时间的单位是秒")]),s._v(" "),e("h3",{attrs:{id:"application和session域范围的属性"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#application和session域范围的属性","aria-hidden":"true"}},[s._v("#")]),s._v(" Application和Session域范围的属性")]),s._v(" "),e("p",[s._v("Application")]),s._v(" "),e("div",{staticClass:"language-java line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletContext")]),s._v(" sc "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("getServletConfig")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("getServletContext")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"session持久化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#session持久化","aria-hidden":"true"}},[s._v("#")]),s._v(" Session持久化")]),s._v(" "),e("p",[s._v("Tomcat提供的2个类来管理Session对象")]),s._v(" "),e("ol",[e("li",[s._v("StandardManager(默认)\n"),e("ul",[e("li",[s._v("当服务器关闭或应用重新加载的时候在work/Catalina/localhost/web/应用名 下创建名为session.ser的文件,将session信息写入,当宠幸加载或重启时读取这个文件,然后删除")])])]),s._v(" "),e("li",[s._v("PersistentManager")])]),s._v(" "),e("h2",{attrs:{id:"url重写"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#url重写","aria-hidden":"true"}},[s._v("#")]),s._v(" URL重写")]),s._v(" "),e("p",[s._v("由于Session依赖于Cookie,当浏览器关闭Cookie时将不能使用Cookie和Session,当这种情况发生时,URL重写就派上用场了.\nURL重写是将SessionID写入到URL当中,就不需要Cookie保存SessionID")]),s._v(" "),e("p",[s._v("URL;jsessionid=id;")]),s._v(" "),e("p",[s._v("重定向中使用URL重写")]),s._v(" "),e("div",{staticClass:"language-java line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-java"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HttpSession")]),s._v(" session "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" requset"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("getSession")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" url "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" resquest"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("encodeRedirectURL")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/aa/bb.html"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nrequest"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sendRedirect")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("url"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("encodeURL()是本应用级别的, encodeRedirectURL()是跨应用的.")]),s._v(" "),e("ol",[e("li",[s._v("response.encodeRedirectURL(url)是一个进行URL重写的方法,  使用这个方法的作用是为了在原来的url后面追加上Jsessionid .  目的是保证即使在客户端浏览器禁止了cookie的情况下, 服务器端仍然能够对其进行事务跟踪.")]),s._v(" "),e("li",[s._v("response.sendRedirect(url) 是一个url重定向的方法,  服务器端的通过该方法, “告诉”客户端的浏览器去访问url所指向的资源")])])])},[],!1,null,null,null);t.default=n.exports}}]);